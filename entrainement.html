<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FitGamify ‚Äì Entra√Ænement</title>
  <style>
    :root{
      --bg1:#0f1623; --bg2:#1b2433; --card:#121a28; --border:#273349;
      --txt:#e8efff; --muted:#9fb2d3; --glow1:#6a8bff; --glow2:#b26bff; --ok:#2ecc71; --btn:#4f7cff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:radial-gradient(1200px 600px at 10% -10%, #1f2a40 0%, transparent 60%),
                 linear-gradient(135deg, var(--bg1), var(--bg2));
      padding:18px; display:flex; justify-content:center;
    }
    .wrap{width:100%; max-width:900px}
    h1{margin:.2rem 0 1rem; font-size:1.7rem;
      background:linear-gradient(90deg,var(--glow1),var(--glow2));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .quote{color:var(--muted); font-style:italic; margin-bottom:12px}
    .card{background:linear-gradient(180deg,#121a28,#0d1523);
      border:1px solid var(--border); border-radius:16px; padding:16px; margin:12px 0}
    label{display:block; color:var(--muted); font-size:.9rem; margin:.35rem 0}
    select,input[type="text"],input[type="number"]{
      width:100%; padding:.6rem .7rem; border-radius:10px; border:1px solid var(--border);
      background:rgba(255,255,255,.04); color:var(--txt);
    }
    .exercise-entry{background:#0e1626; border:1px solid var(--border); border-radius:12px; padding:10px; margin:10px 0}
    .series-row{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0}
    .series-row > *{flex:1 1 120px}
    .btn{background:linear-gradient(135deg,#4f7cff,#22d3ee); color:#0b1020; border:none; border-radius:10px;
      padding:.5rem .8rem; font-weight:700; cursor:pointer}
    .btn:disabled{opacity:.6; cursor:default}
    .btn-ok{background:linear-gradient(135deg,#2ecc71,#27ae60); color:#09141f}
    .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px}
    .timer{color:var(--muted); font-size:.9rem}
    #history{max-height:260px; overflow-y:auto; background:rgba(255,255,255,.03);
      border:1px solid var(--border); border-radius:12px; padding:10px}
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:rgba(0,0,0,.85);color:#fff;
      padding:.6rem .9rem;border-radius:8px;opacity:0;transition:opacity .2s;z-index:9999}
    #toast.show{opacity:1}
  </style>
</head>
<body>
<div class="wrap">
  <h1>üèãÔ∏è FitGamify ‚Äì Entra√Ænement</h1>
  <p class="quote" id="quote">‚ÄúL'entra√Ænement ne ment jamais.‚Äù</p>

  <div class="card">
    <h3 style="margin:0 0 10px">üìã Choisis ton programme</h3>
    <label for="programme">Programme</label>
    <select id="programme" onchange="updateProgram()"></select>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">üìÜ S√©ance du jour</h3>
    <div id="exercises"></div>
    <div class="actions">
      <button class="btn" onclick="saveSession()">üíæ Enregistrer la s√©ance</button>
      <button class="btn" onclick="location.href='index.html'">‚¨ÖÔ∏è Accueil</button>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">üìä Historique local</h3>
    <div id="history">Aucune s√©ance encore.</div>
  </div>
</div>

<div id="toast"></div>

<script>
/* ------- Citations ------- */
const quotes = [
  "‚ÄúCe qui te semble impossible aujourd‚Äôhui sera ton √©chauffement demain.‚Äù",
  "‚ÄúPousse-toi toi-m√™me, personne ne le fera √† ta place.‚Äù",
  "‚ÄúLa discipline, c‚Äôest choisir entre ce que tu veux maintenant et ce que tu veux vraiment.‚Äù",
  "‚ÄúVise le progr√®s, pas la perfection.‚Äù",
  "‚ÄúPas besoin d‚Äô√™tre extr√™me, juste r√©gulier.‚Äù",
  "‚ÄúLa sueur, c‚Äôest juste la graisse qui pleure.‚Äù",
  "‚ÄúLes excuses ne br√ªlent pas de calories.‚Äù",
  "‚ÄúUn jour ou jour un : √† toi de choisir.‚Äù",
  "‚ÄúTa plus grande arme, c‚Äôest ta constance.‚Äù",
  "‚ÄúPlus tu transpires √† l'entra√Ænement, moins tu pleures en comp√©tition.‚Äù"
];
function displayQuote(){ document.getElementById("quote").innerText = quotes[Math.floor(Math.random()*quotes.length)]; }

/* ------- Storage keys ------- */
const LS_PROGRAMS = "fit_programs_v2";
const LS_HISTORY  = "fitHistory";
const LS_LAST     = "fitLastInputs";

/* ------- Fallback programmes (si aucun programme enregistr√©) ------- */
const fallbackPrograms = {
  "Full Body": {
    mode:"series",
    exercises: [
      { name:"Squat machine press", type:"strength", suggested:["50","80","80"] },
      { name:"Split squat", type:"strength", suggested:["10","10","10"] },
      { name:"Deadlift", type:"strength", suggested:["40","40","40"] }
    ]
  },
  "Running": {
    mode:"set",
    exercises: [
      { name:"Course (Distance)", type:"running", distance:["5"], time:["30"] }
    ]
  }
};

/* ------- Utils ------- */
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }
function loadPrograms(){ try{const x=JSON.parse(localStorage.getItem(LS_PROGRAMS)); return x && Object.keys(x).length? x : fallbackPrograms;}catch(e){return fallbackPrograms;} }
function loadHistory(){ return localStorage.getItem(LS_HISTORY)||""; }
function saveHistory(s){ localStorage.setItem(LS_HISTORY, s); }
function loadLast(){ try{return JSON.parse(localStorage.getItem(LS_LAST))||{};}catch(e){return{}} }
function saveLast(o){ localStorage.setItem(LS_LAST, JSON.stringify(o)); }

/* ------- Rendu ------- */
let programs = loadPrograms();
let lastInputs = loadLast();

function populateProgramSelect(){
  const sel = document.getElementById('programme');
  sel.innerHTML = `<option value="">-- S√©lectionner --</option>` +
    Object.keys(programs).sort().map(n=>`<option value="${n}">${n}</option>`).join("");
}

function updateProgram(){
  const progName = document.getElementById('programme').value;
  const zone = document.getElementById('exercises');
  zone.innerHTML = "";
  if(!progName) return;

  const prog = programs[progName];
  if(!prog || !Array.isArray(prog.exercises)){ zone.innerHTML = "<div>Aucun exercice.</div>"; return; }

  prog.exercises.forEach((exo, idx) => {
    const isRun = exo.type==="running";
    let html = `<div class="exercise-entry" id="exo-${idx}">
      <strong>${exo.name || exo.nom || "Exercice"}</strong>`;

    if(isRun){
      const dKey=`distance-${idx}-0`, tKey=`temps-${idx}-0`;
      const dVal = lastInputs[dKey] || (exo.distance?.[0] || "");
      const tVal = lastInputs[tKey] || (exo.time?.[0] || exo.temps?.[0] || "");
      html += `<div class="series-row">
        <div><label>Distance (km)</label><input type="number" id="${dKey}" value="${dVal}" placeholder="${exo.distance?.[0]||''}" /></div>
        <div><label>Temps (min)</label><input type="number" id="${tKey}" value="${tVal}" placeholder="${(exo.time?.[0]||exo.temps?.[0]||'')}" /></div>
      </div>`;
    } else {
      const sugg = exo.suggested || exo.poids || ["","",""];
      for(let s=0; s<3; s++){
        const pKey=`poids-${idx}-${s}`, rKey=`rep-${idx}-${s}`;
        const pVal = lastInputs[pKey] || "";
        const rVal = lastInputs[rKey] || "";
        html += `<div class="series-row">
          <div><label>S√©rie ${s+1} ‚Äî Poids (kg)</label><input type="text" id="${pKey}" value="${pVal}" placeholder="${sugg[s]||''}" /></div>
          <div><label>R√©p√©titions</label><input type="number" id="${rKey}" value="${rVal}" /></div>
        </div>`;
      }
    }

    html += `<div class="actions">
      <button class="btn btn-ok" onclick="markDone(${idx}, this)">‚úÖ Fait</button>
      <button class="btn" onclick="startTimer(this,30)">‚è±Ô∏è R√©cup 30s</button>
      <button class="btn" onclick="startTimer(this,60)">‚è±Ô∏è R√©cup 1min</button>
      <span class="timer" id="timer-${idx}"></span>
    </div></div>`;

    zone.insertAdjacentHTML('beforeend', html);
  });
}

function markDone(index, btn){
  btn.textContent = "‚úÖ Termin√©";
  btn.disabled = true;
}

function startTimer(btn, duration){
  const id = btn.parentElement.parentElement.id.split("-")[1];
  const span = document.getElementById("timer-"+id);
  let t = duration;
  btn.disabled = true;
  const it = setInterval(()=>{
    span.textContent = `${t}s restantes`;
    t--;
    if(t<0){ clearInterval(it); span.textContent=""; btn.disabled=false; }
  },1000);
}

/* ------- Save / History ------- */
function saveSession(){
  const progName = document.getElementById('programme').value;
  if(!progName){ toast("S√©lectionne un programme"); return; }

  const prog = programs[progName];
  let inputs = {};
  let out = `üìÖ ${new Date().toLocaleString()} ‚Äî Programme : ${progName}\n`;

  prog.exercises.forEach((exo, idx)=>{
    out += `üî∏ ${exo.name || exo.nom} :\n`;
    if(exo.type==="running"){
      const d = document.getElementById(`distance-${idx}-0`).value || "n.c.";
      const m = document.getElementById(`temps-${idx}-0`).value || "n.c.";
      out += `   ‚û§ ${d} km en ${m} min\n`;
      inputs[`distance-${idx}-0`] = d; inputs[`temps-${idx}-0`] = m;
    } else {
      for(let s=0; s<3; s++){
        const p = document.getElementById(`poids-${idx}-${s}`).value || "n.c.";
        const r = document.getElementById(`rep-${idx}-${s}`).value || "n.c.";
        out += `   ‚û§ S√©rie ${s+1} ‚Äî ${r} reps @ ${p}kg\n`;
        inputs[`poids-${idx}-${s}`]=p; inputs[`rep-${idx}-${s}`]=r;
      }
    }
  });

  const old = loadHistory();
  saveHistory(out + "\n\n" + old);
  saveLast(inputs);
  toast("üíæ S√©ance enregistr√©e !");
  displayHistory();
}

function displayHistory(){
  const container = document.getElementById('history');
  const h = loadHistory().trim();
  if(!h){ container.textContent="Aucune s√©ance encore."; return; }

  const sessions = h.split("\n\n");
  container.innerHTML = sessions.map((entry, idx)=>{
    const first = (entry.split("\n")[0]||"S√©ance").replace(/</g,"&lt;");
    return `<div style="border-bottom:1px solid var(--border); padding:6px 0; display:flex; gap:10px;">
      <pre style="margin:0; white-space:pre-wrap; flex:1">${entry.replace(/</g,"&lt;")}</pre>
      <button class="btn" style="background:#e53935;color:white" onclick="deleteSession(${idx}, '${encodeURIComponent(first)}')">üóëÔ∏è</button>
    </div>`;
  }).join("");
}

function deleteSession(index, summaryEnc){
  const summary = decodeURIComponent(summaryEnc);
  if(!confirm(`Supprimer d√©finitivement ?\n\n${summary}`)) return;
  const h = loadHistory().trim();
  const sessions = h? h.split("\n\n") : [];
  sessions.splice(index, 1);
  saveHistory(sessions.join("\n\n"));
  displayHistory();
  toast("S√©ance supprim√©e üóëÔ∏è");
}

/* ------- Init ------- */
(function init(){
  displayQuote();
  populateProgramSelect();
  displayHistory();
})();
</script>
</body>
</html>
