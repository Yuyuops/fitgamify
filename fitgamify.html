<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FitGamify Local</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f5f5f5; }
    .card { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .exercise-entry { background: #eef; padding: 0.5rem; border-radius: 6px; margin: 0.5rem 0; }
    .series-row { display: flex; flex-direction: column; gap: 0.5rem; margin: 0.2rem 0; }
    @media(min-width: 500px) {
      .series-row { flex-direction: row; align-items: center; }
    }
    .btn { background: #007bff; color: white; padding: 0.4rem 0.7rem; border: none; border-radius: 4px; margin: 0.2rem; cursor: pointer; }
    .btn:disabled { background: #ccc; cursor: default; }
    .done { background: #28a745 !important; }
    .timer { font-size: 0.9rem; color: #555; margin-left: 0.5rem; }
    h1 { font-size: 1.5rem; }
    input[type="number"], input[type="text"] { width: 6rem; padding: 0.2rem; }
    .quote { font-style: italic; margin-bottom: 1rem; color: #666; }
    #history { max-height: 250px; overflow-y: auto; background: #f9f9f9; padding: 0.5rem; border-radius: 6px; }
    /* Toast */
    #toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; background: rgba(0,0,0,.85); color: white;
      padding: .6rem .9rem; border-radius: 8px; font-size: .95rem;
      opacity: 0; pointer-events: none; transition: opacity .2s ease;
      z-index: 9999;
    }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

<h1>🏋️ FitGamify – Entraînement</h1>
<p class="quote" id="quote">“L'entraînement ne ment jamais.”</p>

<div class="card">
  <h2>📋 Choisis ton programme</h2>
  <select id="programme" onchange="updateProgram()">
    <option value="">-- Sélectionner --</option>
    <option value="Full Body">Full Body</option>
    <option value="Street Workout">Street Workout</option>
    <option value="Running">Running</option>
  </select>
</div>

<div class="card">
  <h2>📆 Séance du jour</h2>
  <div id="exercises"></div>
  <button class="btn" onclick="saveSession()">💾 Enregistrer la séance</button>
</div>

<div class="card">
  <h2>📊 Historique local</h2>
  <div id="history"></div>
</div>

<button id="openStats" style="
  background:#2962ff;
  color:white;
  padding:.5rem 1rem;
  border:none;
  border-radius:8px;
  font-size:1rem;
  cursor:pointer;
  margin:10px 0;
">📊 Voir les statistiques</button>

<div id="toast"></div>

<script>
const quotes = [
  "“Ce qui te semble impossible aujourd’hui sera ton échauffement demain.”",
  "“Pousse-toi toi-même, personne ne le fera à ta place.”",
  "“La discipline, c’est choisir entre ce que tu veux maintenant et ce que tu veux vraiment.”",
  "“Vise le progrès, pas la perfection.”",
  "“Pas besoin d’être extrême, juste régulier.”",
  "“La sueur, c’est juste la graisse qui pleure.”",
  "“Les excuses ne brûlent pas de calories.”",
  "“Un combat se gagne d’abord dans la tête, ensuite sur le ring.”",
  "“Un jour ou jour un : à toi de choisir.”",
  "“La douleur est temporaire, l’abandon est éternel.”",
  "“On ne devient pas fort en restant dans sa zone de confort.”",
  "“Ta plus grande arme, c’est ta constance.”",
  "“Chaque coup que tu encaisses te forge.”",
  "“Si tu veux être un guerrier, agis comme tel, même fatigué.”",
  "“Le mental frappe plus fort que les poings.”",
  "“L’échec n’est pas l’opposé du succès, c’est une étape.”",
  "“Celui qui transpire à l’entraînement saigne moins au combat.”",
  "“N’attends pas d’être motivé, sois discipliné.”",
  "“Tu t’entraînes quand tu en as envie, eux s’entraînent même quand ils n’en ont pas.”",
  "“Ton seul vrai adversaire, c’est celui dans le miroir.”",
  "“Frappe avec conviction, bouge avec intention.”",
  "“Les maîtres ont échoué plus de fois que les débutants n’ont essayé.”",
  "“Plus tu transpires à l'entraînement, moins tu pleures en compétition.”",
  "“Tu n’es pas en concurrence avec les autres. Tu es en concurrence avec toi-même.”"
];

const programmes = {
  "Full Body": [
    { nom: "Squat machine press", poids: ["50", "80", "80"] },
    { nom: "Split squat", poids: ["10", "10", "10"] },
    { nom: "Squat chargé", poids: ["40", "40", "50"] },
    { nom: "Deadlift", poids: ["40", "40", "40"] }
  ],
  "Street Workout": [
    { nom: "Traction", poids: ["PDC", "PDC", "PDC"] },
    { nom: "Dips", poids: ["PDC", "PDC", "PDC"] }
  ],
  "Running": [
    { nom: "Course (Distance)", type: "running", distance: ["5"], temps: ["30"] }
  ]
};

const lastValues = {};

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1600);
}

function displayQuote() {
  const q = quotes[Math.floor(Math.random() * quotes.length)];
  document.getElementById("quote").innerText = q;
}

function updateProgram() {
  const prog = document.getElementById("programme").value;
  const zone = document.getElementById("exercises");
  zone.innerHTML = "";

  if (!prog || !programmes[prog]) return;

  const exos = programmes[prog];

  exos.forEach((exo, exoIndex) => {
    let html = `<div class="exercise-entry" id="exo-${exoIndex}">`;
    html += `<b>${exo.nom}</b><br/>`;

    if (exo.type === "running") {
      for (let i = 0; i < exo.distance.length; i++) {
        const keyD = `distance-${exoIndex}-${i}`;
        const keyT = `temps-${exoIndex}-${i}`;
        const distVal = lastValues[keyD] || "";
        const timeVal = lastValues[keyT] || "";
        html += `
        <div class="series-row">
          Séance ${i + 1} :
          Distance (km) : <input type="number" id="${keyD}" placeholder="${exo.distance[i]}" value="${distVal}">
          Temps (min) : <input type="number" id="${keyT}" placeholder="${exo.temps[i]}" value="${timeVal}">
        </div>`;
      }
    } else {
      for (let serie = 0; serie < exo.poids.length; serie++) {
        const keyP = `poids-${exoIndex}-${serie}`;
        const keyR = `rep-${exoIndex}-${serie}`;
        const poidsVal = lastValues[keyP] || "";
        const repsVal = lastValues[keyR] || "";
        html += `
        <div class="series-row">
          Série ${serie + 1} :
          Poids : <input type="text" id="${keyP}" placeholder="${exo.poids[serie]}" value="${poidsVal}">
          Reps : <input type="number" id="${keyR}" value="${repsVal}">
        </div>`;
      }
    }

    html += `
      <button class="btn" onclick="markDone(${exoIndex}, this)">✅ Fait</button>
      <button class="btn" onclick="startTimer(this, 30)">⏱️ Récup 30s</button>
      <button class="btn" onclick="startTimer(this, 60)">⏱️ Récup 1min</button>
      <span class="timer" id="timer-${exoIndex}"></span>
    </div>`;
    zone.innerHTML += html;
  });
}

function markDone(index, btn) {
  btn.classList.add("done");
  btn.innerText = "✅ Terminé";
  btn.disabled = true;
}

function startTimer(btn, duration) {
  const id = btn.parentElement.id.split("-")[1];
  const span = document.getElementById("timer-" + id);
  let time = duration;
  btn.disabled = true;
  const interval = setInterval(() => {
    span.innerText = `${time}s restantes`;
    time--;
    if (time < 0) {
      clearInterval(interval);
      span.innerText = "";
      btn.disabled = false;
    }
  }, 1000);
}

function saveSession() {
  const prog = document.getElementById("programme").value;
  if (!prog) { toast("Sélectionne un programme d’abord"); return; }

  const date = new Date().toLocaleString();
  let data = `📅 ${date} – Programme : ${prog}\n`;
  const inputsToStore = {};

  const exos = programmes[prog];
  exos.forEach((exo, exoIndex) => {
    data += `🔸 ${exo.nom} :\n`;
    if (exo.type === "running") {
      for (let i = 0; i < exo.distance.length; i++) {
        const d = document.getElementById(`distance-${exoIndex}-${i}`).value || "n.c.";
        const t = document.getElementById(`temps-${exoIndex}-${i}`).value || "n.c.";
        data += `   ➤ Séance ${i + 1} – ${d} km en ${t} min\n`;
        inputsToStore[`distance-${exoIndex}-${i}`] = d;
        inputsToStore[`temps-${exoIndex}-${i}`] = t;
      }
    } else {
      for (let serie = 0; serie < exo.poids.length; serie++) {
        const p = document.getElementById(`poids-${exoIndex}-${serie}`).value || "n.c.";
        const r = document.getElementById(`rep-${exoIndex}-${serie}`).value || "n.c.";
        data += `   ➤ Série ${serie + 1} – ${r} reps @ ${p}kg\n`;
        inputsToStore[`poids-${exoIndex}-${serie}`] = p;
        inputsToStore[`rep-${exoIndex}-${serie}`] = r;
      }
    }
  });

  const old = localStorage.getItem("fitHistory") || "";
  localStorage.setItem("fitHistory", data + "\n\n" + old);
  localStorage.setItem("fitLastInputs", JSON.stringify(inputsToStore));
  toast("💾 Séance enregistrée !");
  displayHistory();
}

function displayHistory() {
  const h = localStorage.getItem("fitHistory") || "";
  if (!h.trim()) {
    document.getElementById("history").innerHTML = "Aucune séance encore.";
    return;
  }

  const sessions = h.trim().split("\n\n");
  let html = "";
  sessions.forEach((entry, idx) => {
    // Récupère la 1ère ligne pour confirmation (date + programme)
    const firstLine = entry.split("\n")[0] || "Séance";
    html += `
      <div style="border-bottom:1px solid #ddd; padding:5px 0; display:flex; gap:10px; align-items:flex-start;">
        <pre style="white-space: pre-wrap; display:inline-block; max-width:80%; margin:0;">${entry}</pre>
        <button onclick="deleteSession(${idx}, '${encodeURIComponent(firstLine)}')" style="background:#e53935;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;">🗑️ Supprimer</button>
      </div>
    `;
  });
  document.getElementById("history").innerHTML = html;
}

function deleteSession(index, summaryEnc) {
  const summary = decodeURIComponent(summaryEnc);
  const ok = confirm(`Supprimer définitivement ?\n\n${summary}`);
  if (!ok) { toast("Suppression annulée"); return; }

  let h = localStorage.getItem("fitHistory") || "";
  let sessions = h.trim().split("\n\n");
  const removed = sessions.splice(index, 1);
  localStorage.setItem("fitHistory", sessions.join("\n\n"));
  displayHistory();
  toast("Séance supprimée 🗑️");
}

function loadLastSession() {
  try {
    const raw = localStorage.getItem("fitLastInputs");
    if (!raw) return;
    const parsed = JSON.parse(raw);
    Object.assign(lastValues, parsed);
  } catch (e) {
    console.warn("Erreur lecture ancienne séance", e);
  }
}

document.getElementById("openStats").addEventListener("click", function() {
  window.open("Graph.html", "_blank");
});

window.onload = () => {
  displayQuote();
  loadLastSession();
  updateProgram();
  displayHistory();
};
</script>

</body>
</html>
