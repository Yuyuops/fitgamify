<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FitGamify – Entraînement</title>
<style>
  :root{
    --bg1:#0f1623; --bg2:#1b2433; --card:#121a28; --border:#273349;
    --txt:#e8efff; --muted:#9fb2d3; --glow1:#6a8bff; --glow2:#b26bff;
    --btn:#3157ff; --btnText:#e8efff; --success:#22c55e; --danger:#e53935;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:18px; color:var(--txt);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:radial-gradient(1200px 600px at 10% -10%, #1f2a40 0%, transparent 60%),
               linear-gradient(135deg, var(--bg1), var(--bg2));
  }
  .wrap{max-width:920px; margin:0 auto; display:grid; gap:14px}
  header{display:flex; align-items:center; justify-content:space-between; gap:10px}
  h1{
    margin:0; font-size:1.6rem;
    background:linear-gradient(90deg,var(--glow1),var(--glow2));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .quote{color:var(--muted); font-style:italic; margin:.2rem 0 1rem}
  .card{
    background:linear-gradient(180deg,#121a28,#0d1523);
    border:1px solid var(--border); border-radius:16px; padding:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
  }
  h2{margin:.2rem 0 1rem; font-size:1.1rem}
  select, input[type="number"], input[type="text"]{
    background:#0f1725; color:var(--txt); border:1px solid #334155;
    padding:10px 12px; border-radius:10px; outline:none;
  }
  .exercise-entry{
    background:#0f1725; border:1px solid #243149; border-radius:12px;
    padding:10px; margin:8px 0;
  }
  .series-row{display:flex; flex-direction:column; gap:8px; margin:.3rem 0}
  @media(min-width:520px){ .series-row{flex-direction:row; align-items:center} }
  .btn{
    background:#263247; color:var(--btnText); border:1px solid #3a4a67;
    padding:.55rem .8rem; border-radius:10px; cursor:pointer; font-weight:600;
  }
  .btn.primary{ background:var(--btn); border-color:var(--btn) }
  .btn.success{ background:var(--success); border-color:transparent; color:#0a2a13 }
  .btn.danger{ background:var(--danger); border-color:transparent }
  .btn:disabled{ opacity:.6; cursor:default }
  .timer{color:var(--muted); font-size:.9rem; margin-left:.4rem}
  #history{
    max-height:320px; overflow:auto; display:grid; gap:8px;
  }
  .hist-item{
    display:flex; gap:10px; align-items:flex-start;
    background:#0f1725; border:1px solid #243149; border-radius:10px; padding:10px;
  }
  .hist-item pre{margin:0; white-space:pre-wrap; color:#cfe3ff}
  .right{margin-left:auto; display:flex; gap:8px}
  /* toast */
  #toast{position:fixed; left:50%; transform:translateX(-50%); bottom:16px;
         background:rgba(0,0,0,.85); color:#fff; padding:.6rem .9rem; border-radius:10px;
         opacity:0; pointer-events:none; transition:opacity .2s; z-index:9999}
  #toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <h1>🏋️ FitGamify – Entraînement</h1>
    <button id="openStats" class="btn">📊 Statistiques</button>
  </header>
  <p class="quote" id="quote">“L'entraînement ne ment jamais.”</p>

  <!-- Choix programme -->
  <div class="card">
    <h2>📋 Choisis ton programme</h2>
    <select id="programme" onchange="updateProgram()">
      <option value="">-- Sélectionner --</option>
      <option value="Full Body">Full Body</option>
      <option value="Street Workout">Street Workout</option>
      <option value="Running">Running</option>
    </select>
  </div>

  <!-- Séance -->
  <div class="card">
    <h2>📆 Séance du jour</h2>
    <div id="exercises"></div>
    <div style="display:flex; gap:8px; margin-top:8px">
      <button class="btn primary" onclick="saveSession()">💾 Enregistrer la séance</button>
    </div>
  </div>

  <!-- Historique -->
  <div class="card">
    <h2>📂 Historique local</h2>
    <div id="history">Aucune séance encore.</div>
  </div>

</div>

<div id="toast"></div>

<script>
/* ---------------- Data ---------------- */
const quotes = [
  "“Ce qui te semble impossible aujourd’hui sera ton échauffement demain.”",
  "“Pousse-toi toi-même, personne ne le fera à ta place.”",
  "“La discipline, c’est choisir entre ce que tu veux maintenant et ce que tu veux vraiment.”",
  "“Vise le progrès, pas la perfection.”",
  "“Pas besoin d’être extrême, juste régulier.”",
  "“La sueur, c’est juste la graisse qui pleure.”",
  "“Les excuses ne brûlent pas de calories.”",
  "“Un combat se gagne d’abord dans la tête, ensuite sur le ring.”",
  "“Un jour ou jour un : à toi de choisir.”",
  "“La douleur est temporaire, l’abandon est éternel.”",
  "“On ne devient pas fort en restant dans sa zone de confort.”",
  "“Ta plus grande arme, c’est ta constance.”",
  "“Chaque coup que tu encaisses te forge.”",
  "“Si tu veux être un guerrier, agis comme tel, même fatigué.”",
  "“Le mental frappe plus fort que les poings.”",
  "“L’échec n’est pas l’opposé du succès, c’est une étape.”",
  "“Celui qui transpire à l’entraînement saigne moins au combat.”",
  "“N’attends pas d’être motivé, sois discipliné.”",
  "“Tu t’entraînes quand tu en as envie, eux s’entraînent même quand ils n’en ont pas.”",
  "“Ton seul vrai adversaire, c’est celui dans le miroir.”",
  "“Frappe avec conviction, bouge avec intention.”",
  "“Les maîtres ont échoué plus de fois que les débutants n’ont essayé.”",
  "“Plus tu transpires à l'entraînement, moins tu pleures en compétition.”",
  "“Tu n’es pas en concurrence avec les autres. Tu es en concurrence avec toi-même.”"
];

const programmes = {
  "Full Body": [
    { nom: "Squat machine press", poids: ["50", "80", "80"] },
    { nom: "Split squat", poids: ["10", "10", "10"] },
    { nom: "Squat chargé", poids: ["40", "40", "50"] },
    { nom: "Deadlift", poids: ["40", "40", "40"] }
  ],
  "Street Workout": [
    { nom: "Traction", poids: ["PDC", "PDC", "PDC"] },
    { nom: "Dips", poids: ["PDC", "PDC", "PDC"] }
  ],
  "Running": [
    { nom: "Course (Distance)", type: "running", distance: ["5"], temps: ["30"] }
  ]
};

const lastValues = {}; // reprend dernières entrées
const HISTORY_KEY = "fitHistory";
const LAST_KEY = "fitLastInputs";

/* ---------------- UI helpers ---------------- */
const $ = id => document.getElementById(id);
function toast(msg){
  const t=$('toast'); t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1400);
}
function displayQuote(){
  $('quote').textContent = quotes[Math.floor(Math.random()*quotes.length)];
}

/* ---------------- Render exercises ---------------- */
function updateProgram(){
  const prog = $('programme').value;
  const zone = $('exercises'); zone.innerHTML = "";
  if(!prog || !programmes[prog]) return;

  programmes[prog].forEach((exo, exoIndex) => {
    let html = `<div class="exercise-entry" id="exo-${exoIndex}">
      <b>${exo.nom}</b><br/>`;

    if (exo.type === "running") {
      for (let i=0;i<exo.distance.length;i++){
        const keyD = `distance-${exoIndex}-${i}`;
        const keyT = `temps-${exoIndex}-${i}`;
        const distVal = lastValues[keyD] || "";
        const timeVal = lastValues[keyT] || "";
        html += `<div class="series-row">
            Séance ${i+1} :
            Distance (km) : <input type="number" id="${keyD}" placeholder="${exo.distance[i]}" value="${distVal}">
            Temps (min) : <input type="number" id="${keyT}" placeholder="${exo.temps[i]}" value="${timeVal}">
          </div>`;
      }
    } else {
      for (let serie=0; serie<exo.poids.length; serie++){
        const keyP = `poids-${exoIndex}-${serie}`;
        const keyR = `rep-${exoIndex}-${serie}`;
        const poidsVal = lastValues[keyP] || "";
        const repsVal  = lastValues[keyR] || "";
        html += `<div class="series-row">
            Série ${serie+1} :
            Poids : <input type="text" id="${keyP}" placeholder="${exo.poids[serie]}" value="${poidsVal}">
            Reps : <input type="number" id="${keyR}" value="${repsVal}">
          </div>`;
      }
    }

    html += `<div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
        <button class="btn success" onclick="markDone(${exoIndex}, this)">✅ Fait</button>
        <button class="btn" onclick="startTimer(this,30)">⏱️ Récup 30s</button>
        <button class="btn" onclick="startTimer(this,60)">⏱️ Récup 1min</button>
        <span class="timer" id="timer-${exoIndex}"></span>
      </div>
    </div>`;

    zone.insertAdjacentHTML('beforeend', html);
  });
}

function markDone(index, btn){
  btn.textContent = "✅ Terminé";
  btn.disabled = true;
}

/* ---------------- Timers ---------------- */
function startTimer(btn, duration){
  const id = btn.parentElement.parentElement.id.split("-")[1];
  const span = $("timer-"+id);
  let t = duration;
  btn.disabled = true;
  span.textContent = `${t}s restantes`;
  const itv = setInterval(()=>{
    t--; span.textContent = t>=0 ? `${t}s restantes` : "";
    if(t<0){ clearInterval(itv); btn.disabled=false; }
  },1000);
}

/* ---------------- Save / history ---------------- */
function saveSession(){
  const prog = $('programme').value;
  if(!prog){ toast("Sélectionne un programme d’abord"); return; }

  const date = new Date().toLocaleString();
  let data = `📅 ${date} – Programme : ${prog}\n`;
  const inputsToStore = {};

  const exos = programmes[prog];
  exos.forEach((exo, exoIndex) => {
    data += `🔸 ${exo.nom} :\n`;
    if (exo.type === "running") {
      for (let i=0;i<exo.distance.length;i++){
        const d = ($(`distance-${exoIndex}-${i}`)||{}).value || "n.c.";
        const t = ($(`temps-${exoIndex}-${i}`)||{}).value || "n.c.";
        data += `   ➤ Séance ${i+1} – ${d} km en ${t} min\n`;
        inputsToStore[`distance-${exoIndex}-${i}`]=d;
        inputsToStore[`temps-${exoIndex}-${i}`]=t;
      }
    } else {
      for (let s=0;s<exo.poids.length;s++){
        const p = ($(`poids-${exoIndex}-${s}`)||{}).value || "n.c.";
        const r = ($(`rep-${exoIndex}-${s}`)||{}).value || "n.c.";
        data += `   ➤ Série ${s+1} – ${r} reps @ ${p}kg\n`;
        inputsToStore[`poids-${exoIndex}-${s}`]=p;
        inputsToStore[`rep-${exoIndex}-${s}`]=r;
      }
    }
  });

  const old = localStorage.getItem(HISTORY_KEY) || "";
  localStorage.setItem(HISTORY_KEY, data + "\n\n" + old);
  localStorage.setItem(LAST_KEY, JSON.stringify(inputsToStore));
  toast("💾 Séance enregistrée !");
  displayHistory();
}

function displayHistory(){
  const h = (localStorage.getItem(HISTORY_KEY) || "").trim();
  const box = $('history'); box.innerHTML = "";
  if(!h){ box.textContent = "Aucune séance encore."; return; }

  const sessions = h.split("\n\n");
  sessions.forEach((entry, idx) => {
    const firstLine = entry.split("\n")[0] || "Séance";
    const div = document.createElement('div');
    div.className = "hist-item";
    div.innerHTML = `
      <pre>${entry}</pre>
      <div class="right">
        <button class="btn danger" onclick="deleteSession(${idx}, '${encodeURIComponent(firstLine)}')">🗑️ Supprimer</button>
      </div>`;
    box.appendChild(div);
  });
}

function deleteSession(index, summaryEnc){
  const summary = decodeURIComponent(summaryEnc);
  if(!confirm(`Supprimer définitivement ?\n\n${summary}`)){ toast("Suppression annulée"); return; }
  let h = (localStorage.getItem(HISTORY_KEY)||"").trim();
  let sessions = h ? h.split("\n\n") : [];
  sessions.splice(index,1);
  localStorage.setItem(HISTORY_KEY, sessions.join("\n\n"));
  displayHistory();
  toast("Séance supprimée 🗑️");
}

function loadLastSession(){
  try{
    const raw = localStorage.getItem(LAST_KEY);
    if(!raw) return;
    Object.assign(lastValues, JSON.parse(raw));
  }catch(e){ console.warn("Erreur lecture ancienne séance", e); }
}

/* ---------------- Init ---------------- */
$('openStats').addEventListener('click', ()=> window.open('graph.html','_blank'));
displayQuote();
loadLastSession();
updateProgram();
displayHistory();
</script>
</body>
</html>
