<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FitGamify Local</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f5f5f5; }
    .card { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .exercise-entry { background: #eef; padding: 0.5rem; border-radius: 6px; margin: 0.5rem 0; }
    .series-row { display: flex; flex-direction: column; gap: 0.5rem; margin: 0.2rem 0; }
    @media(min-width: 500px) {
      .series-row { flex-direction: row; align-items: center; }
    }
    .btn { background: #007bff; color: white; padding: 0.4rem 0.7rem; border: none; border-radius: 4px; margin: 0.2rem; cursor: pointer; }
    .btn:disabled { background: #ccc; cursor: default; }
    .done { background: #28a745 !important; }
    .timer { font-size: 0.9rem; color: #555; margin-left: 0.5rem; }
    h1 { font-size: 1.5rem; }
    input[type="number"], input[type="text"] { width: 6rem; padding: 0.2rem; }
    .quote { font-style: italic; margin-bottom: 1rem; color: #666; }
    #history { max-height: 250px; overflow-y: auto; background: #f9f9f9; padding: 0.5rem; border-radius: 6px; }
    /* Toast */
    #toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; background: rgba(0,0,0,.85); color: white;
      padding: .6rem .9rem; border-radius: 8px; font-size: .95rem;
      opacity: 0; pointer-events: none; transition: opacity .2s ease;
      z-index: 9999;
    }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

<h1>ğŸ‹ï¸ FitGamify â€“ EntraÃ®nement</h1>
<p class="quote" id="quote">â€œL'entraÃ®nement ne ment jamais.â€</p>

<div class="card">
  <h2>ğŸ“‹ Choisis ton programme</h2>
  <select id="programme" onchange="updateProgram()">
    <option value="">-- SÃ©lectionner --</option>
    <option value="Full Body">Full Body</option>
    <option value="Street Workout">Street Workout</option>
    <option value="Running">Running</option>
  </select>
</div>

<div class="card">
  <h2>ğŸ“† SÃ©ance du jour</h2>
  <div id="exercises"></div>
  <button class="btn" onclick="saveSession()">ğŸ’¾ Enregistrer la sÃ©ance</button>
</div>

<div class="card">
  <h2>ğŸ“Š Historique local</h2>
  <div id="history"></div>
</div>

<button id="openStats" style="
  background:#2962ff;
  color:white;
  padding:.5rem 1rem;
  border:none;
  border-radius:8px;
  font-size:1rem;
  cursor:pointer;
  margin:10px 0;
">ğŸ“Š Voir les statistiques</button>

<div id="toast"></div>

<script>
const quotes = [
  "â€œCe qui te semble impossible aujourdâ€™hui sera ton Ã©chauffement demain.â€",
  "â€œPousse-toi toi-mÃªme, personne ne le fera Ã  ta place.â€",
  "â€œLa discipline, câ€™est choisir entre ce que tu veux maintenant et ce que tu veux vraiment.â€",
  "â€œVise le progrÃ¨s, pas la perfection.â€",
  "â€œPas besoin dâ€™Ãªtre extrÃªme, juste rÃ©gulier.â€",
  "â€œLa sueur, câ€™est juste la graisse qui pleure.â€",
  "â€œLes excuses ne brÃ»lent pas de calories.â€",
  "â€œUn combat se gagne dâ€™abord dans la tÃªte, ensuite sur le ring.â€",
  "â€œUn jour ou jour un : Ã  toi de choisir.â€",
  "â€œLa douleur est temporaire, lâ€™abandon est Ã©ternel.â€",
  "â€œOn ne devient pas fort en restant dans sa zone de confort.â€",
  "â€œTa plus grande arme, câ€™est ta constance.â€",
  "â€œChaque coup que tu encaisses te forge.â€",
  "â€œSi tu veux Ãªtre un guerrier, agis comme tel, mÃªme fatiguÃ©.â€",
  "â€œLe mental frappe plus fort que les poings.â€",
  "â€œLâ€™Ã©chec nâ€™est pas lâ€™opposÃ© du succÃ¨s, câ€™est une Ã©tape.â€",
  "â€œCelui qui transpire Ã  lâ€™entraÃ®nement saigne moins au combat.â€",
  "â€œNâ€™attends pas dâ€™Ãªtre motivÃ©, sois disciplinÃ©.â€",
  "â€œTu tâ€™entraÃ®nes quand tu en as envie, eux sâ€™entraÃ®nent mÃªme quand ils nâ€™en ont pas.â€",
  "â€œTon seul vrai adversaire, câ€™est celui dans le miroir.â€",
  "â€œFrappe avec conviction, bouge avec intention.â€",
  "â€œLes maÃ®tres ont Ã©chouÃ© plus de fois que les dÃ©butants nâ€™ont essayÃ©.â€",
  "â€œPlus tu transpires Ã  l'entraÃ®nement, moins tu pleures en compÃ©tition.â€",
  "â€œTu nâ€™es pas en concurrence avec les autres. Tu es en concurrence avec toi-mÃªme.â€"
];

const programmes = {
  "Full Body": [
    { nom: "Squat machine press", poids: ["50", "80", "80"] },
    { nom: "Split squat", poids: ["10", "10", "10"] },
    { nom: "Squat chargÃ©", poids: ["40", "40", "50"] },
    { nom: "Deadlift", poids: ["40", "40", "40"] }
  ],
  "Street Workout": [
    { nom: "Traction", poids: ["PDC", "PDC", "PDC"] },
    { nom: "Dips", poids: ["PDC", "PDC", "PDC"] }
  ],
  "Running": [
    { nom: "Course (Distance)", type: "running", distance: ["5"], temps: ["30"] }
  ]
};

const lastValues = {};

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1600);
}

function displayQuote() {
  const q = quotes[Math.floor(Math.random() * quotes.length)];
  document.getElementById("quote").innerText = q;
}

function updateProgram() {
  const prog = document.getElementById("programme").value;
  const zone = document.getElementById("exercises");
  zone.innerHTML = "";

  if (!prog || !programmes[prog]) return;

  const exos = programmes[prog];

  exos.forEach((exo, exoIndex) => {
    let html = `<div class="exercise-entry" id="exo-${exoIndex}">`;
    html += `<b>${exo.nom}</b><br/>`;

    if (exo.type === "running") {
      for (let i = 0; i < exo.distance.length; i++) {
        const keyD = `distance-${exoIndex}-${i}`;
        const keyT = `temps-${exoIndex}-${i}`;
        const distVal = lastValues[keyD] || "";
        const timeVal = lastValues[keyT] || "";
        html += `
        <div class="series-row">
          SÃ©ance ${i + 1} :
          Distance (km) : <input type="number" id="${keyD}" placeholder="${exo.distance[i]}" value="${distVal}">
          Temps (min) : <input type="number" id="${keyT}" placeholder="${exo.temps[i]}" value="${timeVal}">
        </div>`;
      }
    } else {
      for (let serie = 0; serie < exo.poids.length; serie++) {
        const keyP = `poids-${exoIndex}-${serie}`;
        const keyR = `rep-${exoIndex}-${serie}`;
        const poidsVal = lastValues[keyP] || "";
        const repsVal = lastValues[keyR] || "";
        html += `
        <div class="series-row">
          SÃ©rie ${serie + 1} :
          Poids : <input type="text" id="${keyP}" placeholder="${exo.poids[serie]}" value="${poidsVal}">
          Reps : <input type="number" id="${keyR}" value="${repsVal}">
        </div>`;
      }
    }

    html += `
      <button class="btn" onclick="markDone(${exoIndex}, this)">âœ… Fait</button>
      <button class="btn" onclick="startTimer(this, 30)">â±ï¸ RÃ©cup 30s</button>
      <button class="btn" onclick="startTimer(this, 60)">â±ï¸ RÃ©cup 1min</button>
      <span class="timer" id="timer-${exoIndex}"></span>
    </div>`;
    zone.innerHTML += html;
  });
}

function markDone(index, btn) {
  btn.classList.add("done");
  btn.innerText = "âœ… TerminÃ©";
  btn.disabled = true;
}

function startTimer(btn, duration) {
  const id = btn.parentElement.id.split("-")[1];
  const span = document.getElementById("timer-" + id);
  let time = duration;
  btn.disabled = true;
  const interval = setInterval(() => {
    span.innerText = `${time}s restantes`;
    time--;
    if (time < 0) {
      clearInterval(interval);
      span.innerText = "";
      btn.disabled = false;
    }
  }, 1000);
}

function saveSession() {
  const prog = document.getElementById("programme").value;
  if (!prog) { toast("SÃ©lectionne un programme dâ€™abord"); return; }

  const date = new Date().toLocaleString();
  let data = `ğŸ“… ${date} â€“ Programme : ${prog}\n`;
  const inputsToStore = {};

  const exos = programmes[prog];
  exos.forEach((exo, exoIndex) => {
    data += `ğŸ”¸ ${exo.nom} :\n`;
    if (exo.type === "running") {
      for (let i = 0; i < exo.distance.length; i++) {
        const d = document.getElementById(`distance-${exoIndex}-${i}`).value || "n.c.";
        const t = document.getElementById(`temps-${exoIndex}-${i}`).value || "n.c.";
        data += `   â¤ SÃ©ance ${i + 1} â€“ ${d} km en ${t} min\n`;
        inputsToStore[`distance-${exoIndex}-${i}`] = d;
        inputsToStore[`temps-${exoIndex}-${i}`] = t;
      }
    } else {
      for (let serie = 0; serie < exo.poids.length; serie++) {
        const p = document.getElementById(`poids-${exoIndex}-${serie}`).value || "n.c.";
        const r = document.getElementById(`rep-${exoIndex}-${serie}`).value || "n.c.";
        data += `   â¤ SÃ©rie ${serie + 1} â€“ ${r} reps @ ${p}kg\n`;
        inputsToStore[`poids-${exoIndex}-${serie}`] = p;
        inputsToStore[`rep-${exoIndex}-${serie}`] = r;
      }
    }
  });

  const old = localStorage.getItem("fitHistory") || "";
  localStorage.setItem("fitHistory", data + "\n\n" + old);
  localStorage.setItem("fitLastInputs", JSON.stringify(inputsToStore));
  toast("ğŸ’¾ SÃ©ance enregistrÃ©e !");
  displayHistory();
}

function displayHistory() {
  const h = localStorage.getItem("fitHistory") || "";
  if (!h.trim()) {
    document.getElementById("history").innerHTML = "Aucune sÃ©ance encore.";
    return;
  }

  const sessions = h.trim().split("\n\n");
  let html = "";
  sessions.forEach((entry, idx) => {
    // RÃ©cupÃ¨re la 1Ã¨re ligne pour confirmation (date + programme)
    const firstLine = entry.split("\n")[0] || "SÃ©ance";
    html += `
      <div style="border-bottom:1px solid #ddd; padding:5px 0; display:flex; gap:10px; align-items:flex-start;">
        <pre style="white-space: pre-wrap; display:inline-block; max-width:80%; margin:0;">${entry}</pre>
        <button onclick="deleteSession(${idx}, '${encodeURIComponent(firstLine)}')" style="background:#e53935;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;">ğŸ—‘ï¸ Supprimer</button>
      </div>
    `;
  });
  document.getElementById("history").innerHTML = html;
}

function deleteSession(index, summaryEnc) {
  const summary = decodeURIComponent(summaryEnc);
  const ok = confirm(`Supprimer dÃ©finitivement ?\n\n${summary}`);
  if (!ok) { toast("Suppression annulÃ©e"); return; }

  let h = localStorage.getItem("fitHistory") || "";
  let sessions = h.trim().split("\n\n");
  const removed = sessions.splice(index, 1);
  localStorage.setItem("fitHistory", sessions.join("\n\n"));
  displayHistory();
  toast("SÃ©ance supprimÃ©e ğŸ—‘ï¸");
}

function loadLastSession() {
  try {
    const raw = localStorage.getItem("fitLastInputs");
    if (!raw) return;
    const parsed = JSON.parse(raw);
    Object.assign(lastValues, parsed);
  } catch (e) {
    console.warn("Erreur lecture ancienne sÃ©ance", e);
  }
}

document.getElementById("openStats").addEventListener("click", function() {
  window.open("Graph.html", "_blank");
});

window.onload = () => {
  displayQuote();
  loadLastSession();
  updateProgram();
  displayHistory();
};
</script>

</body>
</html>
