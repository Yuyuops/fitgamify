<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FitGamify â€“ EntraÃ®nement</title>
<style>
  :root{
    --bg1:#0f1623; --bg2:#1b2433; --card:#121a28; --border:#273349;
    --txt:#e8efff; --muted:#9fb2d3; --glow1:#6a8bff; --glow2:#b26bff;
    --btn:#3157ff; --btnText:#e8efff; --success:#22c55e; --danger:#e53935;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:18px; color:var(--txt);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:radial-gradient(1200px 600px at 10% -10%, #1f2a40 0%, transparent 60%),
               linear-gradient(135deg, var(--bg1), var(--bg2));
  }
  .wrap{max-width:920px; margin:0 auto; display:grid; gap:14px}
  header{display:flex; align-items:center; justify-content:space-between; gap:10px}
  h1{
    margin:0; font-size:1.6rem;
    background:linear-gradient(90deg,var(--glow1),var(--glow2));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .quote{color:var(--muted); font-style:italic; margin:.2rem 0 1rem}
  .card{
    background:linear-gradient(180deg,#121a28,#0d1523);
    border:1px solid var(--border); border-radius:16px; padding:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
  }
  h2{margin:.2rem 0 1rem; font-size:1.1rem}
  select, input[type="number"], input[type="text"]{
    background:#0f1725; color:var(--txt); border:1px solid #334155;
    padding:10px 12px; border-radius:10px; outline:none;
  }
  .exercise-entry{
    background:#0f1725; border:1px solid #243149; border-radius:12px;
    padding:10px; margin:8px 0;
  }
  .series-row{display:flex; flex-direction:column; gap:8px; margin:.3rem 0}
  @media(min-width:520px){ .series-row{flex-direction:row; align-items:center} }
  .btn{
    background:#263247; color:var(--btnText); border:1px solid #3a4a67;
    padding:.55rem .8rem; border-radius:10px; cursor:pointer; font-weight:600;
  }
  .btn.primary{ background:var(--btn); border-color:var(--btn) }
  .btn.success{ background:var(--success); border-color:transparent; color:#0a2a13 }
  .btn.danger{ background:var(--danger); border-color:transparent }
  .btn:disabled{ opacity:.6; cursor:default }
  .timer{color:var(--muted); font-size:.9rem; margin-left:.4rem}
  #history{
    max-height:320px; overflow:auto; display:grid; gap:8px;
  }
  .hist-item{
    display:flex; gap:10px; align-items:flex-start;
    background:#0f1725; border:1px solid #243149; border-radius:10px; padding:10px;
  }
  .hist-item pre{margin:0; white-space:pre-wrap; color:#cfe3ff}
  .right{margin-left:auto; display:flex; gap:8px}
  /* toast */
  #toast{position:fixed; left:50%; transform:translateX(-50%); bottom:16px;
         background:rgba(0,0,0,.85); color:#fff; padding:.6rem .9rem; border-radius:10px;
         opacity:0; pointer-events:none; transition:opacity .2s; z-index:9999}
  #toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <h1>ğŸ‹ï¸ FitGamify â€“ EntraÃ®nement</h1>
    <button id="openStats" class="btn">ğŸ“Š Statistiques</button>
  </header>
  <p class="quote" id="quote">â€œL'entraÃ®nement ne ment jamais.â€</p>

  <!-- Choix programme -->
  <div class="card">
    <h2>ğŸ“‹ Choisis ton programme</h2>
    <select id="programme" onchange="updateProgram()">
      <option value="">-- SÃ©lectionner --</option>
      <option value="Full Body">Full Body</option>
      <option value="Street Workout">Street Workout</option>
      <option value="Running">Running</option>
    </select>
  </div>

  <!-- SÃ©ance -->
  <div class="card">
    <h2>ğŸ“† SÃ©ance du jour</h2>
    <div id="exercises"></div>
    <div style="display:flex; gap:8px; margin-top:8px">
      <button class="btn primary" onclick="saveSession()">ğŸ’¾ Enregistrer la sÃ©ance</button>
    </div>
  </div>

  <!-- Historique -->
  <div class="card">
    <h2>ğŸ“‚ Historique local</h2>
    <div id="history">Aucune sÃ©ance encore.</div>
  </div>

</div>

<div id="toast"></div>

<script>
/* ---------------- Data ---------------- */
const quotes = [
  "â€œCe qui te semble impossible aujourdâ€™hui sera ton Ã©chauffement demain.â€",
  "â€œPousse-toi toi-mÃªme, personne ne le fera Ã  ta place.â€",
  "â€œLa discipline, câ€™est choisir entre ce que tu veux maintenant et ce que tu veux vraiment.â€",
  "â€œVise le progrÃ¨s, pas la perfection.â€",
  "â€œPas besoin dâ€™Ãªtre extrÃªme, juste rÃ©gulier.â€",
  "â€œLa sueur, câ€™est juste la graisse qui pleure.â€",
  "â€œLes excuses ne brÃ»lent pas de calories.â€",
  "â€œUn combat se gagne dâ€™abord dans la tÃªte, ensuite sur le ring.â€",
  "â€œUn jour ou jour un : Ã  toi de choisir.â€",
  "â€œLa douleur est temporaire, lâ€™abandon est Ã©ternel.â€",
  "â€œOn ne devient pas fort en restant dans sa zone de confort.â€",
  "â€œTa plus grande arme, câ€™est ta constance.â€",
  "â€œChaque coup que tu encaisses te forge.â€",
  "â€œSi tu veux Ãªtre un guerrier, agis comme tel, mÃªme fatiguÃ©.â€",
  "â€œLe mental frappe plus fort que les poings.â€",
  "â€œLâ€™Ã©chec nâ€™est pas lâ€™opposÃ© du succÃ¨s, câ€™est une Ã©tape.â€",
  "â€œCelui qui transpire Ã  lâ€™entraÃ®nement saigne moins au combat.â€",
  "â€œNâ€™attends pas dâ€™Ãªtre motivÃ©, sois disciplinÃ©.â€",
  "â€œTu tâ€™entraÃ®nes quand tu en as envie, eux sâ€™entraÃ®nent mÃªme quand ils nâ€™en ont pas.â€",
  "â€œTon seul vrai adversaire, câ€™est celui dans le miroir.â€",
  "â€œFrappe avec conviction, bouge avec intention.â€",
  "â€œLes maÃ®tres ont Ã©chouÃ© plus de fois que les dÃ©butants nâ€™ont essayÃ©.â€",
  "â€œPlus tu transpires Ã  l'entraÃ®nement, moins tu pleures en compÃ©tition.â€",
  "â€œTu nâ€™es pas en concurrence avec les autres. Tu es en concurrence avec toi-mÃªme.â€"
];

const programmes = {
  "Full Body": [
    { nom: "Squat machine press", poids: ["50", "80", "80"] },
    { nom: "Split squat", poids: ["10", "10", "10"] },
    { nom: "Squat chargÃ©", poids: ["40", "40", "50"] },
    { nom: "Deadlift", poids: ["40", "40", "40"] }
  ],
  "Street Workout": [
    { nom: "Traction", poids: ["PDC", "PDC", "PDC"] },
    { nom: "Dips", poids: ["PDC", "PDC", "PDC"] }
  ],
  "Running": [
    { nom: "Course (Distance)", type: "running", distance: ["5"], temps: ["30"] }
  ]
};

const lastValues = {}; // reprend derniÃ¨res entrÃ©es
const HISTORY_KEY = "fitHistory";
const LAST_KEY = "fitLastInputs";

/* ---------------- UI helpers ---------------- */
const $ = id => document.getElementById(id);
function toast(msg){
  const t=$('toast'); t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1400);
}
function displayQuote(){
  $('quote').textContent = quotes[Math.floor(Math.random()*quotes.length)];
}

/* ---------------- Render exercises ---------------- */
function updateProgram(){
  const prog = $('programme').value;
  const zone = $('exercises'); zone.innerHTML = "";
  if(!prog || !programmes[prog]) return;

  programmes[prog].forEach((exo, exoIndex) => {
    let html = `<div class="exercise-entry" id="exo-${exoIndex}">
      <b>${exo.nom}</b><br/>`;

    if (exo.type === "running") {
      for (let i=0;i<exo.distance.length;i++){
        const keyD = `distance-${exoIndex}-${i}`;
        const keyT = `temps-${exoIndex}-${i}`;
        const distVal = lastValues[keyD] || "";
        const timeVal = lastValues[keyT] || "";
        html += `<div class="series-row">
            SÃ©ance ${i+1} :
            Distance (km) : <input type="number" id="${keyD}" placeholder="${exo.distance[i]}" value="${distVal}">
            Temps (min) : <input type="number" id="${keyT}" placeholder="${exo.temps[i]}" value="${timeVal}">
          </div>`;
      }
    } else {
      for (let serie=0; serie<exo.poids.length; serie++){
        const keyP = `poids-${exoIndex}-${serie}`;
        const keyR = `rep-${exoIndex}-${serie}`;
        const poidsVal = lastValues[keyP] || "";
        const repsVal  = lastValues[keyR] || "";
        html += `<div class="series-row">
            SÃ©rie ${serie+1} :
            Poids : <input type="text" id="${keyP}" placeholder="${exo.poids[serie]}" value="${poidsVal}">
            Reps : <input type="number" id="${keyR}" value="${repsVal}">
          </div>`;
      }
    }

    html += `<div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
        <button class="btn success" onclick="markDone(${exoIndex}, this)">âœ… Fait</button>
        <button class="btn" onclick="startTimer(this,30)">â±ï¸ RÃ©cup 30s</button>
        <button class="btn" onclick="startTimer(this,60)">â±ï¸ RÃ©cup 1min</button>
        <span class="timer" id="timer-${exoIndex}"></span>
      </div>
    </div>`;

    zone.insertAdjacentHTML('beforeend', html);
  });
}

function markDone(index, btn){
  btn.textContent = "âœ… TerminÃ©";
  btn.disabled = true;
}

/* ---------------- Timers ---------------- */
function startTimer(btn, duration){
  const id = btn.parentElement.parentElement.id.split("-")[1];
  const span = $("timer-"+id);
  let t = duration;
  btn.disabled = true;
  span.textContent = `${t}s restantes`;
  const itv = setInterval(()=>{
    t--; span.textContent = t>=0 ? `${t}s restantes` : "";
    if(t<0){ clearInterval(itv); btn.disabled=false; }
  },1000);
}

/* ---------------- Save / history ---------------- */
function saveSession(){
  const prog = $('programme').value;
  if(!prog){ toast("SÃ©lectionne un programme dâ€™abord"); return; }

  const date = new Date().toLocaleString();
  let data = `ğŸ“… ${date} â€“ Programme : ${prog}\n`;
  const inputsToStore = {};

  const exos = programmes[prog];
  exos.forEach((exo, exoIndex) => {
    data += `ğŸ”¸ ${exo.nom} :\n`;
    if (exo.type === "running") {
      for (let i=0;i<exo.distance.length;i++){
        const d = ($(`distance-${exoIndex}-${i}`)||{}).value || "n.c.";
        const t = ($(`temps-${exoIndex}-${i}`)||{}).value || "n.c.";
        data += `   â¤ SÃ©ance ${i+1} â€“ ${d} km en ${t} min\n`;
        inputsToStore[`distance-${exoIndex}-${i}`]=d;
        inputsToStore[`temps-${exoIndex}-${i}`]=t;
      }
    } else {
      for (let s=0;s<exo.poids.length;s++){
        const p = ($(`poids-${exoIndex}-${s}`)||{}).value || "n.c.";
        const r = ($(`rep-${exoIndex}-${s}`)||{}).value || "n.c.";
        data += `   â¤ SÃ©rie ${s+1} â€“ ${r} reps @ ${p}kg\n`;
        inputsToStore[`poids-${exoIndex}-${s}`]=p;
        inputsToStore[`rep-${exoIndex}-${s}`]=r;
      }
    }
  });

  const old = localStorage.getItem(HISTORY_KEY) || "";
  localStorage.setItem(HISTORY_KEY, data + "\n\n" + old);
  localStorage.setItem(LAST_KEY, JSON.stringify(inputsToStore));
  toast("ğŸ’¾ SÃ©ance enregistrÃ©e !");
  displayHistory();
}

function displayHistory(){
  const h = (localStorage.getItem(HISTORY_KEY) || "").trim();
  const box = $('history'); box.innerHTML = "";
  if(!h){ box.textContent = "Aucune sÃ©ance encore."; return; }

  const sessions = h.split("\n\n");
  sessions.forEach((entry, idx) => {
    const firstLine = entry.split("\n")[0] || "SÃ©ance";
    const div = document.createElement('div');
    div.className = "hist-item";
    div.innerHTML = `
      <pre>${entry}</pre>
      <div class="right">
        <button class="btn danger" onclick="deleteSession(${idx}, '${encodeURIComponent(firstLine)}')">ğŸ—‘ï¸ Supprimer</button>
      </div>`;
    box.appendChild(div);
  });
}

function deleteSession(index, summaryEnc){
  const summary = decodeURIComponent(summaryEnc);
  if(!confirm(`Supprimer dÃ©finitivement ?\n\n${summary}`)){ toast("Suppression annulÃ©e"); return; }
  let h = (localStorage.getItem(HISTORY_KEY)||"").trim();
  let sessions = h ? h.split("\n\n") : [];
  sessions.splice(index,1);
  localStorage.setItem(HISTORY_KEY, sessions.join("\n\n"));
  displayHistory();
  toast("SÃ©ance supprimÃ©e ğŸ—‘ï¸");
}

function loadLastSession(){
  try{
    const raw = localStorage.getItem(LAST_KEY);
    if(!raw) return;
    Object.assign(lastValues, JSON.parse(raw));
  }catch(e){ console.warn("Erreur lecture ancienne sÃ©ance", e); }
}

/* ---------------- Init ---------------- */
$('openStats').addEventListener('click', ()=> window.open('graph.html','_blank'));
displayQuote();
loadLastSession();
updateProgram();
displayHistory();
</script>
</body>
</html>
