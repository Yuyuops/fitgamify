<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FitGamify — Programmes & Exercices</title>
<style>
  :root {
    --bg:#0f172a; --card:#0b1220cc; --muted:#94a3b8; --accent:#60a5fa; --accent-2:#22d3ee;
    --text:#e5e7eb; --ok:#22c55e; --danger:#ef4444;
  }
  html,body{margin:0;padding:0;background:linear-gradient(135deg,#0b1220,#111827);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .container{max-width:1000px;margin:0 auto;padding:20px}
  h1{font-size:1.6rem;margin:.2rem 0 1rem}
  .card{background:var(--card);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;margin:14px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 220px;min-width:220px}
  label{display:block;color:var(--muted);font-size:.85rem;margin:.3rem 0}
  input,select,textarea{width:100%;padding:.65rem .75rem;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
  input::placeholder{color:#93a0b3}
  textarea{min-height:80px}
  .btn{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1020;border:none;border-radius:10px;padding:.6rem .9rem;font-weight:600;cursor:pointer}
  .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18)}
  .btn.danger{background:linear-gradient(135deg,#ef4444,#f97316);color:white}
  .btn.ok{background:linear-gradient(135deg,#22c55e,#10b981);color:#05210f}
  .pill{display:inline-block;padding:.15rem .5rem;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:.78rem;color:#c7d2fe}
  .tiny{font-size:.84rem;color:var(--muted)}
  .divider{height:1px;background:rgba(255,255,255,.08);margin:12px 0}
  .list-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid rgba(255,255,255,.12);border-radius:10px;margin:8px 0;background:rgba(255,255,255,.03)}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px}
  .chip{display:flex;gap:8px;align-items:flex-start;border:1px dashed rgba(255,255,255,.15);padding:10px;border-radius:10px;background:rgba(255,255,255,.03)}
  .img-prev{width:56px;height:56px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.14)}
  .toggle{display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer}
  .chev{transition:.2s transform}
  .collapsed .chev{transform:rotate(-90deg)}
  .collapsed .collapsible{display:none}
  /* Toast */
  #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:rgba(0,0,0,.85);color:white;padding:.6rem .9rem;border-radius:8px;font-size:.95rem;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:9999}
  #toast.show{opacity:1}
</style>
</head>
<body>
  <div class="container">
    <h1>🧱 FitGamify — Exercices & Programmes</h1>

    <!-- CATALOGUE EXERCICES -->
    <div class="card">
      <div class="toggle" onclick="toggleCard('ex-card')">
        <div>
          <strong>📚 Catalogue d’exercices</strong>
          <div class="tiny">Crée/édite des exercices réutilisables (avec reps, poids et/ou durée, + image URL).</div>
        </div>
        <div class="chev">▼</div>
      </div>

      <div id="ex-card" class="collapsible" style="margin-top:10px">
        <div class="row">
          <div class="col">
            <label>Nom de l’exercice</label>
            <input id="exName" placeholder="ex: Squat, Tirage, Course, Planche…" />
          </div>
          <div class="col">
            <label>Répétitions (optionnel)</label>
            <input id="exReps" placeholder="ex: 10 ou 8-12" />
          </div>
          <div class="col">
            <label>Poids suggéré (optionnel)</label>
            <input id="exWeight" placeholder="ex: 40kg, PDC…" />
          </div>
          <div class="col">
            <label>Durée (sec/min) (optionnel)</label>
            <input id="exTime" placeholder="ex: 30s, 1min, 90s" />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label>URL image (optionnel)</label>
            <input id="exImg" placeholder="https://…/illustration.png" />
          </div>
          <div class="col" style="display:flex;align-items:flex-end;gap:8px">
            <button class="btn ok" onclick="saveExercise()">💾 Enregistrer/Mettre à jour</button>
            <button class="btn secondary" onclick="resetExerciseForm()">Réinitialiser</button>
          </div>
        </div>

        <div class="divider"></div>
        <div class="row">
          <div class="col">
            <label>🔎 Rechercher</label>
            <input id="exSearch" placeholder="Filtrer par nom…" oninput="renderExerciseList()" />
          </div>
        </div>
        <div id="exerciseList" class="grid"></div>
      </div>
    </div>

    <!-- CONSTRUCTEUR DE PROGRAMMES -->
    <div class="card">
      <div class="toggle" onclick="toggleCard('prog-card')">
        <div>
          <strong>🧩 Créer / Modifier un programme</strong>
          <div class="tiny">Assemble tes programmes à partir des exercices du catalogue, ou ajoute-en à la volée.</div>
        </div>
        <div class="chev">▼</div>
      </div>

      <div id="prog-card" class="collapsible" style="margin-top:10px">
        <div class="row">
          <div class="col">
            <label>Nom du programme</label>
            <input id="progName" placeholder="ex: Full Body, Street Workout, Running…" />
          </div>
          <div class="col">
            <label>Mode d’exécution</label>
            <select id="execMode">
              <option value="series">Séries (exercice par exercice)</option>
              <option value="set">Set / Circuit (enchaîner tous, puis répéter)</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>
        <div class="row">
          <div class="col">
            <label>Ajouter depuis le catalogue</label>
            <select id="catalogPicker"></select>
          </div>
          <div class="col" style="display:flex;align-items:flex-end;gap:8px">
            <button class="btn secondary" onclick="addFromCatalog()">+ Ajouter</button>
          </div>
        </div>

        <div class="tiny" style="margin:.25rem 0">…ou ajouter un exercice personnalisé juste pour ce programme :</div>
        <div class="row">
          <div class="col">
            <label>Nom</label>
            <input id="inlineName" placeholder="ex: Squat jump (bonus)" />
          </div>
          <div class="col">
            <label>Répétitions</label>
            <input id="inlineReps" placeholder="ex: 20" />
          </div>
          <div class="col">
            <label>Poids</label>
            <input id="inlineWeight" placeholder="ex: PDC / 10kg…" />
          </div>
          <div class="col">
            <label>Durée</label>
            <input id="inlineTime" placeholder="ex: 60s" />
          </div>
          <div class="col" style="display:flex;align-items:flex-end">
            <button class="btn secondary" onclick="addInlineExercise()">+ Ajouter au programme</button>
          </div>
        </div>

        <div id="programExerciseList" style="margin-top:10px"></div>

        <div class="divider"></div>
        <div class="actions">
          <button class="btn ok" onclick="saveProgram()">💾 Enregistrer le programme</button>
          <button class="btn secondary" onclick="resetProgramForm()">Réinitialiser</button>
        </div>
      </div>
    </div>

    <!-- MES PROGRAMMES -->
    <div class="card">
      <strong>📂 Mes programmes</strong>
      <div class="tiny">Voir / Éditer / Supprimer. La page Entraînement lira automatiquement cette liste.</div>
      <div id="programList" style="margin-top:10px"></div>
    </div>

    <div id="toast"></div>
  </div>

<script>
  const LS_EX = "fit_exercises_v1";
  const LS_PROG = "fit_programs_v2";

  let exEditing = null;           // nom en édition (exercice)
  let progEditing = null;         // nom en édition (programme)
  let progBuffer = [];            // exercices du programme courant

  // ---------- TOAST ----------
  function toast(msg){
    const t=document.getElementById('toast');
    t.textContent=msg;t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),1600);
  }

  // ---------- TOGGLES ----------
  function toggleCard(id){
    const card = document.getElementById(id);
    const wrapper = card.parentElement; // .card
    wrapper.classList.toggle('collapsed');
  }

  // ---------- STORAGE HELPERS ----------
  function loadExercises(){
    try{ return JSON.parse(localStorage.getItem(LS_EX)) || {}; }catch(e){ return {}; }
  }
  function saveExercises(obj){ localStorage.setItem(LS_EX, JSON.stringify(obj)); }

  function loadPrograms(){
    try{ return JSON.parse(localStorage.getItem(LS_PROG)) || {}; }catch(e){ return {}; }
  }
  function savePrograms(obj){ localStorage.setItem(LS_PROG, JSON.stringify(obj)); }

  // ---------- EXERCISES (CATALOGUE) ----------
  function renderExerciseList(){
    const list = document.getElementById('exerciseList');
    const search = (document.getElementById('exSearch').value || "").toLowerCase();
    const ex = loadExercises();
    const names = Object.keys(ex).sort();

    const filtered = names.filter(n => n.toLowerCase().includes(search));

    if(filtered.length===0){
      list.innerHTML = '<div class="tiny">Aucun exercice. Ajoute-en un ci-dessus 😉</div>';
      renderCatalogPicker(); // keep picker in sync
      return;
    }

    list.innerHTML = filtered.map(n=>{
      const e = ex[n];
      return `
        <div class="chip">
          ${e.img?`<img class="img-prev" src="${e.img}" alt="img" onerror="this.style.display='none'">`:``}
          <div style="flex:1">
            <div><b>${n}</b></div>
            <div class="tiny">
              ${e.reps?`Reps: ${e.reps} · `:``}
              ${e.weight?`Poids: ${e.weight} · `:``}
              ${e.time?`Durée: ${e.time} · `:``}
              ${e.img?`<span>Image: oui</span>`:``}
            </div>
          </div>
          <div class="actions">
            <button class="btn secondary" onclick="editExercise('${encodeURIComponent(n)}')">Éditer</button>
            <button class="btn danger" onclick="deleteExercise('${encodeURIComponent(n)}')">Supprimer</button>
          </div>
        </div>
      `;
    }).join("");

    renderCatalogPicker();
  }

  function renderCatalogPicker(){
    const sel = document.getElementById('catalogPicker');
    const ex = loadExercises();
    const names = Object.keys(ex).sort();
    sel.innerHTML = names.length
      ? `<option value="">-- Sélectionne un exercice --</option>` + names.map(n=>`<option>${n}</option>`).join("")
      : `<option value="">(aucun exercice dans le catalogue)</option>`;
  }

  function saveExercise(){
    const name = (document.getElementById('exName').value || "").trim();
    const reps = (document.getElementById('exReps').value || "").trim();
    const weight = (document.getElementById('exWeight').value || "").trim();
    const time = (document.getElementById('exTime').value || "").trim();
    const img = (document.getElementById('exImg').value || "").trim();
    if(!name){ toast("Nom de l’exercice requis"); return; }

    const store = loadExercises();
    // si renommage
    if(exEditing && exEditing !== name){
      delete store[exEditing];
    }
    store[name] = { reps, weight, time, img };
    saveExercises(store);
    renderExerciseList();
    exEditing = name;
    toast("Exercice enregistré ✅");
  }

  function editExercise(nameEnc){
    const name = decodeURIComponent(nameEnc);
    const ex = loadExercises()[name];
    if(!ex){ toast("Introuvable"); return; }
    exEditing = name;
    document.getElementById('exName').value = name;
    document.getElementById('exReps').value = ex.reps || "";
    document.getElementById('exWeight').value = ex.weight || "";
    document.getElementById('exTime').value = ex.time || "";
    document.getElementById('exImg').value = ex.img || "";
    toast("Edition de l’exercice chargée ✏️");
  }

  function deleteExercise(nameEnc){
    const name = decodeURIComponent(nameEnc);
    if(!confirm(`Supprimer l’exercice « ${name} » ?`)) return;
    const store = loadExercises();
    delete store[name];
    saveExercises(store);
    if(exEditing===name){ resetExerciseForm(); }
    renderExerciseList();
    toast("Exercice supprimé 🗑️");
  }

  function resetExerciseForm(){
    exEditing = null;
    document.getElementById('exName').value="";
    document.getElementById('exReps').value="";
    document.getElementById('exWeight').value="";
    document.getElementById('exTime').value="";
    document.getElementById('exImg').value="";
  }

  // ---------- PROGRAM BUILDER ----------
  function addFromCatalog(){
    const pick = document.getElementById('catalogPicker').value;
    if(!pick){ toast("Choisis un exercice du catalogue"); return; }
    const ex = loadExercises()[pick];
    progBuffer.push({ name: pick, ...ex });
    renderProgramBuffer();
  }

  function addInlineExercise(){
    const name = (document.getElementById('inlineName').value || "").trim();
    const reps = (document.getElementById('inlineReps').value || "").trim();
    const weight = (document.getElementById('inlineWeight').value || "").trim();
    const time = (document.getElementById('inlineTime').value || "").trim();
    if(!name){ toast("Nom requis"); return; }
    progBuffer.push({ name, reps, weight, time, img:"" });
    renderProgramBuffer();
    document.getElementById('inlineName').value="";
    document.getElementById('inlineReps').value="";
    document.getElementById('inlineWeight').value="";
    document.getElementById('inlineTime').value="";
  }

  function renderProgramBuffer(){
    const wrap = document.getElementById('programExerciseList');
    if(progBuffer.length===0){ wrap.innerHTML = '<div class="tiny">Aucun exercice ajouté à ce programme.</div>'; return; }
    wrap.innerHTML = progBuffer.map((e,i)=>`
      <div class="list-item">
        <div>
          <div><b>${e.name}</b> ${e.reps?`· ${e.reps} reps`:``} ${e.weight?`· ${e.weight}`:``} ${e.time?`· ${e.time}`:``}</div>
          ${e.img?`<div class="tiny">${e.img}</div>`:``}
        </div>
        <div class="actions">
          <button class="btn secondary" onclick="moveUp(${i})">↑</button>
          <button class="btn secondary" onclick="moveDown(${i})">↓</button>
          <button class="btn danger" onclick="removeFromProgram(${i})">Retirer</button>
        </div>
      </div>
    `).join("");
  }

  function moveUp(i){ if(i<=0) return; [progBuffer[i-1], progBuffer[i]]=[progBuffer[i], progBuffer[i-1]]; renderProgramBuffer(); }
  function moveDown(i){ if(i>=progBuffer.length-1) return; [progBuffer[i+1], progBuffer[i]]=[progBuffer[i], progBuffer[i+1]]; renderProgramBuffer(); }
  function removeFromProgram(i){ progBuffer.splice(i,1); renderProgramBuffer(); }

  function saveProgram(){
    const name = (document.getElementById('progName').value || "").trim();
    const mode = document.getElementById('execMode').value;
    if(!name){ toast("Nom du programme requis"); return; }
    if(progBuffer.length===0){ toast("Ajoute au moins un exercice au programme"); return; }
    const store = loadPrograms();
    if(progEditing && progEditing !== name){
      delete store[progEditing];
    }
    store[name] = { mode, exercises: progBuffer };
    savePrograms(store);
    progEditing = name;
    renderProgramList();
    toast("Programme enregistré ✅");
  }

  function renderProgramList(){
    const list = document.getElementById('programList');
    const store = loadPrograms();
    const names = Object.keys(store).sort();
    if(names.length===0){ list.innerHTML = '<div class="tiny">Aucun programme pour le moment.</div>'; return; }
    list.innerHTML = names.map(n=>{
      const p = store[n];
      return `
        <div class="list-item">
          <div>
            <div><b>${n}</b> <span class="pill">${p.mode==="series"?"Séries":"Set/Circuit"}</span></div>
            <div class="tiny">${p.exercises.length} exercice(s)</div>
          </div>
          <div class="actions">
            <button class="btn secondary" onclick="previewProg('${encodeURIComponent(n)}')">Voir</button>
            <button class="btn" onclick="editProgram('${encodeURIComponent(n)}')">Éditer</button>
            <button class="btn danger" onclick="deleteProgram('${encodeURIComponent(n)}')">Supprimer</button>
          </div>
        </div>
      `;
    }).join("");
  }

  function previewProg(nameEnc){
    const name = decodeURIComponent(nameEnc);
    const p = loadPrograms()[name];
    if(!p){ toast("Introuvable"); return; }
    const lines = p.exercises.map((e,i)=>`• ${i+1}. ${e.name}${e.reps?` — ${e.reps} reps`:``}${e.weight?` — ${e.weight}`:``}${e.time?` — ${e.time}`:``}`).join("\n");
    alert(`🏷️ ${name}\nMode: ${p.mode==="series"?"Séries":"Set/Circuit"}\n\n${lines}`);
  }

  function editProgram(nameEnc){
    const name = decodeURIComponent(nameEnc);
    const p = loadPrograms()[name];
    if(!p){ toast("Introuvable"); return; }
    progEditing = name;
    document.getElementById('progName').value = name;
    document.getElementById('execMode').value = p.mode || "series";
    progBuffer = (p.exercises || []).map(e=>({...e}));
    renderProgramBuffer();

    // ouvre le panneau si fermé
    const card = document.getElementById('prog-card');
    const wrapper = card.parentElement;
    if(wrapper.classList.contains('collapsed')) toggleCard('prog-card');
    toast("Édition du programme chargée ✏️");
  }

  function deleteProgram(nameEnc){
    const name = decodeURIComponent(nameEnc);
    if(!confirm(`Supprimer le programme « ${name} » ?`)) return;
    const store = loadPrograms();
    delete store[name];
    savePrograms(store);
    if(progEditing===name) resetProgramForm();
    renderProgramList();
    toast("Programme supprimé 🗑️");
  }

  function resetProgramForm(){
    progEditing = null;
    progBuffer = [];
    document.getElementById('progName').value="";
    document.getElementById('execMode').value="series";
    renderProgramBuffer();
  }

  // ---------- INIT ----------
  (function init(){
    renderExerciseList();
    renderProgramList();
  })();
</script>
</body>
</html>
