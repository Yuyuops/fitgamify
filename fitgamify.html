<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FitGamify — Programmes</title>
<style>
  :root {
    --bg:#0f172a; --card:#0b1220cc; --muted:#94a3b8; --accent:#60a5fa; --accent-2:#22d3ee;
    --text:#e5e7eb; --ok:#22c55e; --danger:#ef4444;
  }
  html,body{margin:0;padding:0;background:linear-gradient(135deg,#0b1220,#111827);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .container{max-width:900px;margin:0 auto;padding:20px}
  h1{font-size:1.6rem;margin:.2rem 0 1rem}
  .card{background:var(--card);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;margin:14px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 220px}
  label{display:block;color:var(--muted);font-size:.85rem;margin:.3rem 0}
  input,select,textarea{width:100%;padding:.65rem .75rem;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
  input::placeholder{color:#93a0b3}
  textarea{min-height:80px}
  .btn{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1020;border:none;border-radius:10px;padding:.6rem .9rem;font-weight:600;cursor:pointer}
  .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18)}
  .btn.danger{background:linear-gradient(135deg,#ef4444,#f97316);color:white}
  .btn.ok{background:linear-gradient(135deg,#22c55e,#10b981);color:#05210f}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .exercise-chip{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,.04);border:1px dashed rgba(255,255,255,.15);padding:10px;border-radius:10px}
  .tiny{font-size:.8rem;color:var(--muted)}
  .list-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid rgba(255,255,255,.12);border-radius:10px;margin:8px 0;background:rgba(255,255,255,.03)}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .toggle{display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer}
  .chev{transition:.2s transform}
  .collapsed .chev{transform:rotate(-90deg)}
  .collapsed .collapsible{display:none}
  .pill{display:inline-block;padding:.15rem .5rem;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:.78rem;color:#c7d2fe}
  .hint{color:#93c5fd;font-size:.85rem}
  .divider{height:1px;background:rgba(255,255,255,.08);margin:10px 0}
  .img-prev{width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.14)}
  /* Toast */
  #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:rgba(0,0,0,.85);color:white;padding:.6rem .9rem;border-radius:8px;font-size:.95rem;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:9999}
  #toast.show{opacity:1}
</style>
</head>
<body>
  <div class="container">
    <h1>🧱 FitGamify — Programmes</h1>

    <!-- SECTION CRÉER / MODIFIER (réductible) -->
    <div id="builder-card" class="card">
      <div class="toggle" onclick="toggleBuilder()">
        <div>
          <strong>Créer / Modifier un programme</strong>
          <div class="tiny">Ajoute un programme, des exercices, choisis l’exécution <span class="pill">Séries</span> ou <span class="pill">Set/Circuit</span>.</div>
        </div>
        <div class="chev">▼</div>
      </div>

      <div class="collapsible" style="margin-top:10px">
        <div class="row">
          <div class="col">
            <label>Nom du programme</label>
            <input id="progName" placeholder="ex: Full Body, Street Workout, Running..." />
          </div>
          <div class="col">
            <label>Mode d’exécution</label>
            <select id="execMode">
              <option value="series">Séries (exercice par exercice)</option>
              <option value="set">Set / Circuit (enchaîner tous, puis répéter)</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>
        <div class="row">
          <div class="col">
            <label>Nom de l’exercice</label>
            <input id="exName" placeholder="ex: Squat, Tirage horizontal..." />
          </div>
          <div class="col">
            <label>Réps par série <span class="tiny">(optionnel)</span></label>
            <input id="exReps" type="text" placeholder="ex: 10 (ou 10-12)" />
          </div>
          <div class="col">
            <label>Poids suggéré <span class="tiny">(optionnel)</span></label>
            <input id="exWeight" type="text" placeholder="ex: 40kg, PDC..." />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label>URL image (optionnel)</label>
            <input id="exImg" placeholder="https://…/mon_exercice.png" />
            <div class="tiny hint">Tu peux mettre une URL d’illustration (ex : image trouvée sur le net).</div>
          </div>
          <div class="col" style="display:flex;align-items:flex-end">
            <button class="btn secondary" onclick="addExercise()">+ Ajouter l’exercice</button>
          </div>
        </div>

        <div id="exerciseList"></div>

        <div class="divider"></div>
        <div class="actions">
          <button class="btn ok" onclick="saveProgram()">💾 Enregistrer le programme</button>
          <button class="btn secondary" onclick="resetForm()">Réinitialiser</button>
        </div>
      </div>
    </div>

    <!-- SECTION MES PROGRAMMES -->
    <div class="card">
      <strong>Mes programmes</strong>
      <div class="tiny">Clique sur <b>Voir</b> pour prévisualiser la structure, <b>Éditer</b> pour modifier, <b>Supprimer</b> pour enlever.</div>
      <div id="programList" style="margin-top:10px"></div>
    </div>

    <div id="toast"></div>
  </div>

<script>
  const LS_KEY = "fit_programs_v2";
  const LS_BUILDER_OPEN = "fit_builder_open";
  let editingName = null;       // si on modifie un programme existant
  let bufferExercises = [];     // exercices en cours d'édition

  // ---- UI helpers
  function toast(msg){
    const t=document.getElementById('toast');
    t.textContent=msg;t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),1600);
  }
  function toggleBuilder(){
    const card=document.getElementById('builder-card');
    const collapsed=card.classList.toggle('collapsed');
    localStorage.setItem(LS_BUILDER_OPEN, collapsed? "0":"1");
  }

  // ---- Storage
  function loadPrograms(){
    try{
      return JSON.parse(localStorage.getItem(LS_KEY)) || {};
    }catch(e){ return {}; }
  }
  function savePrograms(obj){
    localStorage.setItem(LS_KEY, JSON.stringify(obj));
  }

  // ---- Builder form
  function addExercise(){
    const name = document.getElementById('exName').value.trim();
    const reps = document.getElementById('exReps').value.trim();
    const weight = document.getElementById('exWeight').value.trim();
    const img = document.getElementById('exImg').value.trim();

    if(!name){ toast("Donne un nom à l’exercice 🙂"); return; }

    bufferExercises.push({ name, reps, weight, img });
    renderExerciseList();
    document.getElementById('exName').value="";
    document.getElementById('exReps').value="";
    document.getElementById('exWeight').value="";
    document.getElementById('exImg').value="";
  }

  function removeExercise(idx){
    bufferExercises.splice(idx,1);
    renderExerciseList();
  }

  function renderExerciseList(){
    const wrap = document.getElementById('exerciseList');
    if(bufferExercises.length===0){ wrap.innerHTML = '<div class="tiny" style="margin-top:6px">Aucun exercice ajouté pour l’instant.</div>'; return; }
    wrap.innerHTML = bufferExercises.map((ex,i)=>`
      <div class="exercise-chip">
        ${ex.img ? `<img class="img-prev" src="${ex.img}" alt="img" onerror="this.style.display='none'">` : ``}
        <div style="flex:1">
          <div><b>${ex.name}</b> ${ex.reps?`· ${ex.reps} reps`:``} ${ex.weight?`· ${ex.weight}`:``}</div>
          ${ex.img?`<div class="tiny">${ex.img}</div>`:``}
        </div>
        <button class="btn danger" onclick="removeExercise(${i})">Supprimer</button>
      </div>
    `).join("");
  }

  function resetForm(){
    editingName = null;
    bufferExercises = [];
    document.getElementById('progName').value = "";
    document.getElementById('execMode').value = "series";
    renderExerciseList();
    toast("Formulaire réinitialisé");
  }

  function saveProgram(){
    const name = (document.getElementById('progName').value || "").trim();
    const mode = document.getElementById('execMode').value;
    if(!name){ toast("Nom du programme requis"); return; }
    if(bufferExercises.length===0){ toast("Ajoute au moins un exercice"); return; }

    const store = loadPrograms();
    // Si on renomme un programme en cours d’édition
    if(editingName && editingName !== name){
      delete store[editingName];
    }
    store[name] = { mode, exercises: bufferExercises };
    savePrograms(store);
    renderProgramList();
    toast("Programme enregistré ✅");
    editingName = name;
  }

  function renderProgramList(){
    const list = document.getElementById('programList');
    const store = loadPrograms();
    const names = Object.keys(store);
    if(names.length===0){ list.innerHTML = '<div class="tiny">Aucun programme pour le moment.</div>'; return; }

    list.innerHTML = names.map(n=>{
      const p = store[n];
      return `
        <div class="list-item">
          <div>
            <div><b>${n}</b> <span class="pill">${p.mode==="series"?"Séries":"Set/Circuit"}</span></div>
            <div class="tiny">${p.exercises.length} exercice(s)</div>
          </div>
          <div class="actions">
            <button class="btn secondary" onclick="preview('${encodeURIComponent(n)}')">Voir</button>
            <button class="btn" onclick="editProgram('${encodeURIComponent(n)}')">Éditer</button>
            <button class="btn danger" onclick="deleteProgram('${encodeURIComponent(n)}')">Supprimer</button>
          </div>
        </div>
      `;
    }).join("");
  }

  function preview(nameEnc){
    const name = decodeURIComponent(nameEnc);
    const p = loadPrograms()[name];
    if(!p){ toast("Introuvable"); return; }
    const lines = p.exercises.map((e,i)=>`• ${i+1}. ${e.name}${e.reps?` — ${e.reps} reps`:``}${e.weight?` — ${e.weight}`:``}`).join("\n");
    alert(`🏷️ ${name}\nMode: ${p.mode==="series"?"Séries":"Set/Circuit"}\n\n${lines}`);
  }

  function editProgram(nameEnc){
    const name = decodeURIComponent(nameEnc);
    const p = loadPrograms()[name];
    if(!p){ toast("Introuvable"); return; }
    editingName = name;
    document.getElementById('progName').value = name;
    document.getElementById('execMode').value = p.mode || "series";
    bufferExercises = (p.exercises || []).map(e=>({...e}));
    renderExerciseList();

    // ouvrir la section si elle est fermée
    const card=document.getElementById('builder-card');
    if(card.classList.contains('collapsed')) toggleBuilder();
    toast("Edition du programme chargée ✏️");
  }

  function deleteProgram(nameEnc){
    const name = decodeURIComponent(nameEnc);
    if(!confirm(`Supprimer définitivement « ${name} » ?`)) return;
    const store = loadPrograms();
    delete store[name];
    savePrograms(store);
    if(editingName===name) resetForm();
    renderProgramList();
    toast("Programme supprimé 🗑️");
  }

  // ---- Init
  (function init(){
    // état d’ouverture/fermeture mémorisé
    const open = localStorage.getItem(LS_BUILDER_OPEN);
    if(open==="0"){ document.getElementById('builder-card').classList.add('collapsed'); }
    renderExerciseList();
    renderProgramList();
  })();
</script>
</body>
</html>
