<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FitGamify – Compléments</title>
<style>
  :root{
    --bg1:#0f1623; --bg2:#1b2433; --card:#121a28; --border:#273349;
    --txt:#e8efff; --muted:#9fb2d3; --glow1:#6a8bff; --glow2:#b26bff;
    --btn:#3157ff; --good:#22c55e; --warn:#f59e0b; --danger:#e53935;
    --chip:#0f1725; --chipBorder:#243149;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:18px; color:var(--txt);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:radial-gradient(1200px 600px at 10% -10%, #1f2a40 0%, transparent 60%),
               linear-gradient(135deg, var(--bg1), var(--bg2));
  }
  .wrap{max-width:980px; margin:0 auto; display:grid; gap:16px}
  header{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  h1{
    margin:0; font-size:1.6rem;
    background:linear-gradient(90deg,var(--glow1),var(--glow2));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .nav{display:flex; gap:8px; flex-wrap:wrap}
  .btn{
    background:#263247; color:#e8efff; border:1px solid #3a4a67;
    padding:.55rem .8rem; border-radius:10px; cursor:pointer; font-weight:600; text-decoration:none;
  }
  .btn.primary{ background:var(--btn); border-color:var(--btn) }
  .btn.good{ background:var(--good); border-color:transparent; color:#0b2a13 }
  .btn.warn{ background:#3a2a12; border-color:#6b4e14; color:#ffde9a }
  .btn.danger{ background:var(--danger); border-color:transparent }
  .btn:disabled{opacity:.6; cursor:default}
  .card{
    background:linear-gradient(180deg,#121a28,#0d1523);
    border:1px solid var(--border); border-radius:16px; padding:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
  }
  h2{margin:.2rem 0 1rem; font-size:1.1rem}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .chip{
    background:var(--chip); border:1px solid var(--chipBorder);
    color:var(--txt); padding:.35rem .6rem; border-radius:999px; font-size:.95rem;
  }
  .title{letter-spacing:.12em; color:#a9bbdb; font-weight:700; margin:4px 0 10px}
  .muted{color:var(--muted)}
  /* Date nav */
  .dateNav{display:flex; align-items:center; gap:8px}
  .dateNav button{width:38px; height:38px; padding:0; border-radius:8px}
  /* Toggle rows */
  .supp-row{
    display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center;
    background:#0f1725; border:1px solid #243149; border-radius:12px; padding:12px;
  }
  .supp-meta{color:var(--muted); font-size:.95rem}
  .pill{
    display:inline-flex; align-items:center; gap:8px; border-radius:999px; padding:8px 12px;
    border:1px solid #3a4a67; cursor:pointer; background:#1a2335;
  }
  .pill.on{ background:#15321f; border-color:#1d7a3e; color:#d7ffe6 }
  .pill svg{flex:0 0 auto}
  .section-actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  /* Stats */
  .kpi{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px}
  .kpi .box{background:#0f1725; border:1px solid #243149; border-radius:12px; padding:12px}
  .kpi .label{color:var(--muted); font-size:.9rem}
  .kpi .value{font-size:1.25rem; font-weight:800}
  /* History */
  #history{display:grid; gap:8px; max-height:320px; overflow:auto}
  .hist-item{
    background:#0f1725; border:1px solid #243149; border-radius:12px; padding:10px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .badges{display:flex; gap:6px; flex-wrap:wrap}
  .badge{background:#142137; border:1px solid #2b3952; color:#cfe3ff; border-radius:999px; padding:.2rem .5rem; font-size:.85rem}
  /* Toast */
  #toast{position:fixed; left:50%; transform:translateX(-50%); bottom:16px;
         background:rgba(0,0,0,.85); color:#fff; padding:.6rem .9rem; border-radius:10px;
         opacity:0; pointer-events:none; transition:opacity .2s; z-index:9999}
  #toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <h1>🧪 FitGamify – Compléments</h1>
    <div class="nav">
      <a class="btn" href="index.html">🏠 Accueil</a>
      <a class="btn" href="fitgamify.html">🏋️ Entraînement</a>
      <a class="btn" href="graph.html">📈 Statistiques</a>
      <a class="btn" href="eau.html">💧 Hydratation & Journal</a>
    </div>
  </header>

  <!-- Jour & actions -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="title">SUIVI DU JOUR</div>
        <div class="muted">Coche ce que tu as pris aujourd’hui. Sauvegarde auto.</div>
      </div>
      <div class="dateNav">
        <button id="prevDay">◀</button>
        <span class="chip" id="dateLabel">—</span>
        <button id="nextDay">▶</button>
      </div>
    </div>

    <!-- Créatine -->
    <div class="supp-row">
      <div>
        <b>Matin (avec repas) — Créatine (Creapure®)</b>
        <div class="supp-meta">5 gélules (≈ 2.5 g) avec un grand verre d’eau<span class="muted"> — ⚡️ + force, + puissance, récupération, cognition</span></div>
      </div>
      <button id="pill-crea" class="pill">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#91a8d8"/></svg>
        <span>Non pris</span>
      </button>
    </div>

    <!-- Oméga-3 -->
    <div class="supp-row">
      <div>
        <b>Déjeuner (avec graisses) — Oméga-3 (EPA/DHA)</b>
        <div class="supp-meta">2 gélules avec repas contenant des lipides<span class="muted"> — 🧠 Anti-inflammatoire, articulations, cardio & cerveau</span></div>
      </div>
      <button id="pill-omega" class="pill">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#91a8d8"/></svg>
        <span>Non pris</span>
      </button>
    </div>

    <!-- Ashwagandha -->
    <div class="supp-row">
      <div>
        <b>Soir (après dîner) — Ashwagandha (KSM-66)</b>
        <div class="supp-meta">1 gélule (500 mg), cure 2–3 mois puis pause 2 semaines<span class="muted"> — 😴 Stress ↓, récup nerveuse, sommeil, régulation hormonale</span></div>
      </div>
      <button id="pill-ashwa" class="pill">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#91a8d8"/></svg>
        <span>Non pris</span>
      </button>
    </div>

    <div class="section-actions">
      <button id="markAll" class="btn good">✅ Tout pris aujourd’hui</button>
      <button id="resetDay" class="btn warn">↺ Réinitialiser le jour</button>
      <button id="saveBtn" class="btn primary">💾 Enregistrer</button>
    </div>
  </div>

  <!-- Stats -->
  <div class="card">
    <h2>📈 Streaks & Régularité</h2>
    <div class="kpi">
      <div class="box">
        <div class="label">Streak créatine</div>
        <div class="value" id="streakCrea">0 j</div>
      </div>
      <div class="box">
        <div class="label">Streak oméga-3</div>
        <div class="value" id="streakOmega">0 j</div>
      </div>
      <div class="box">
        <div class="label">Streak ashwagandha</div>
        <div class="value" id="streakAshwa">0 j</div>
      </div>
    </div>
    <div class="kpi" style="margin-top:10px">
      <div class="box">
        <div class="label">Régularité 7 jours</div>
        <div class="value" id="rate7">–</div>
      </div>
      <div class="box">
        <div class="label">Régularité 30 jours</div>
        <div class="value" id="rate30">–</div>
      </div>
      <div class="box">
        <div class="label">Jours “tout pris” (30 j)</div>
        <div class="value" id="all30">0</div>
      </div>
    </div>
  </div>

  <!-- Recos -->
  <div class="card">
    <h2>🧭 Recommandations</h2>
    <div class="row" style="gap:6px; flex-wrap:wrap">
      <span class="chip">✅ Créatine : tous les jours, même sans entraînement</span>
      <span class="chip">✅ Oméga-3 : en continu (ou 3 mois ON / 1 OFF)</span>
      <span class="chip">✅ Ashwagandha : en cure, éviter > 8 semaines d’affilée</span>
    </div>
  </div>

  <!-- Historique -->
  <div class="card">
    <h2>🗂 Historique (14 derniers jours)</h2>
    <div id="history" class="muted">—</div>
  </div>

</div>

<div id="toast"></div>

<script>
/* ===== State ===== */
const LS_KEY = "supplementTrackerV1";
function ymd(d){ return d.toISOString().slice(0,10); }
function addDays(date, n){ const d = new Date(date); d.setDate(d.getDate()+n); return d; }

const state = loadState();
let currentDate = new Date();

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return { days:{} };
    const obj = JSON.parse(raw);
    obj.days = obj.days || {};
    return obj;
  }catch(e){
    console.warn("Reset state", e);
    return { days:{} };
  }
}
function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); toast("💾 Sauvegardé"); }
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200);}

/* ===== Day helpers ===== */
function getDay(k){ return state.days[k] || { crea:false, omega:false, ashwa:false }; }
function setDay(k, d){ state.days[k]=d; saveState(); renderStats(); renderHistory(); }
function setDateLabel(){
  document.getElementById('dateLabel').textContent =
    currentDate.toLocaleDateString(undefined,{weekday:'short',year:'numeric',month:'short',day:'numeric'});
}

/* ===== UI Rendering ===== */
function renderDay(){
  const key = ymd(currentDate);
  const d = getDay(key);
  setDateLabel();

  setPill('pill-crea', d.crea);
  setPill('pill-omega', d.omega);
  setPill('pill-ashwa', d.ashwa);
}
function setPill(id, on){
  const el = document.getElementById(id);
  el.classList.toggle('on', !!on);
  el.innerHTML = on
    ? `✅ <span>Pris</span>`
    : `<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#91a8d8"/></svg><span>Non pris</span>`;
}

/* ===== Events ===== */
document.getElementById('pill-crea').onclick = ()=>{
  const k=ymd(currentDate); const d=getDay(k); d.crea=!d.crea; setDay(k,d); renderDay();
};
document.getElementById('pill-omega').onclick = ()=>{
  const k=ymd(currentDate); const d=getDay(k); d.omega=!d.omega; setDay(k,d); renderDay();
};
document.getElementById('pill-ashwa').onclick = ()=>{
  const k=ymd(currentDate); const d=getDay(k); d.ashwa=!d.ashwa; setDay(k,d); renderDay();
};

document.getElementById('markAll').onclick = ()=>{
  const k=ymd(currentDate); const d=getDay(k);
  d.crea=true; d.omega=true; d.ashwa=true;
  setDay(k,d); renderDay();
};
document.getElementById('resetDay').onclick = ()=>{
  const k=ymd(currentDate);
  setDay(k,{crea:false,omega:false,ashwa:false});
  renderDay();
};
document.getElementById('saveBtn').onclick = saveState;

document.getElementById('prevDay').onclick = ()=>{ currentDate = addDays(currentDate,-1); renderDay(); };
document.getElementById('nextDay').onclick = ()=>{ currentDate = addDays(currentDate, 1); renderDay(); };

/* ===== Stats ===== */
function streakFor(flag){
  // compte à rebours depuis aujourd’hui tant que flag=true
  let streak=0;
  let d = new Date();
  while(true){
    const k = ymd(d);
    const day = getDay(k);
    if(!day[flag]) break;
    streak++; d = addDays(d,-1);
  }
  return streak;
}
function compliance(flag, horizonDays){
  let ok=0, tot=horizonDays;
  for(let i=0;i<horizonDays;i++){
    const k = ymd(addDays(new Date(), -i));
    const day = getDay(k);
    if(day[flag]) ok++;
  }
  return Math.round(ok*100/tot);
}
function allTakenDays(horizonDays){
  let cnt=0;
  for(let i=0;i<horizonDays;i++){
    const k = ymd(addDays(new Date(), -i));
    const d = getDay(k);
    if(d.crea && d.omega && d.ashwa) cnt++;
  }
  return cnt;
}

function renderStats(){
  document.getElementById('streakCrea').textContent = streakFor('crea') + " j";
  document.getElementById('streakOmega').textContent = streakFor('omega') + " j";
  document.getElementById('streakAshwa').textContent = streakFor('ashwa') + " j";

  const r7 = Math.round((compliance('crea',7)+compliance('omega',7)+compliance('ashwa',7))/3);
  const r30= Math.round((compliance('crea',30)+compliance('omega',30)+compliance('ashwa',30))/3);
  document.getElementById('rate7').textContent = r7 + " %";
  document.getElementById('rate30').textContent = r30 + " %";
  document.getElementById('all30').textContent = allTakenDays(30);
}

/* ===== History ===== */
function renderHistory(){
  const box = document.getElementById('history');
  box.innerHTML = "";
  const today = new Date();
  for(let i=0;i<14;i++){
    const d = addDays(today,-i);
    const k = ymd(d);
    const v = getDay(k);
    const line = document.createElement('div');
    line.className = "hist-item";
    line.innerHTML = `
      <div>
        <b>${d.toLocaleDateString()}</b>
        <div class="badges">
          <span class="badge">${v.crea ? "✅ Créatine" : "— Créatine"}</span>
          <span class="badge">${v.omega ? "✅ Oméga-3" : "— Oméga-3"}</span>
          <span class="badge">${v.ashwa ? "✅ Ashwagandha" : "— Ashwagandha"}</span>
        </div>
      </div>
      <button class="btn danger" onclick="eraseDay('${k}')">🗑️</button>
    `;
    box.appendChild(line);
  }
}
function eraseDay(k){
  if(!confirm("Effacer les prises de ce jour ?")) return;
  delete state.days[k]; saveState(); renderDay(); renderStats(); renderHistory();
  toast("Jour effacé");
}

/* ===== Init ===== */
renderDay();
renderStats();
renderHistory();
</script>
</body>
</html>